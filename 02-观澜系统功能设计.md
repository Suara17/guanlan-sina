# 观澜（GuanLan）生产可视化门户功能设计

## 功能架构

```
观澜系统
├── 首页导航栏
│   ├── 公司Logo
│   ├── 产品系统（洞微/格物/天筹/浑天）
│   ├── 监控演示
│   ├── 客户案例
│   └── 关于我们/登录
│
├── 监控演示模块
│   ├── 导航栏（选择工厂/生产线/模块）
│   ├── 生产总览仪表盘
│   │   ├── 计划生产量 vs 实时生产量
│   │   ├── 实时看板（预计完成时间）
│   │   ├── 生产线状态（超时/正常）
│   │   └── 产线问题所在（瓶颈工位热力图）
│   │
│   ├── 监控演示-问题检测
│   │   ├── 产线问题位置展示
│   │   ├── 问题列表
│   │   │   ├── 按工位分类
│   │   │   ├── 按问题类型分类
│   │   │   ├── 按缺陷程度排序
│   │   │   └── 按影响时间筛选
│   │   └── 问题判断（跳转司南）
│   │
│   └── 监控演示-问题判断（司南集成）
│
└── 数据追溯与下钻
    ├── 工单号追溯
    ├── 工位详情页
    ├── 缺陷图像墙
    └── 报表导出（Excel/PDF）
```

---

## 1. 生产总览仪表盘

### 1.1 功能要求

**1. 进度对比组件**
   - 计划生产量（目标值）
   - 实时生产量（当前完成数）
   - 预计完工时间（基于流速预测）
   - 可视化形式：甘特图 + 进度条

**2. 质量指标看板**
   - 整体良品率（百分比 + 趋势折线图）
   - 不良率分层（按工位/缺陷类型）
   - Top N缺陷帕累托图

**3. 产线状态监控**
   - 生产线状态标识（超时红色/正常绿色）
   - 关键工位CT（Cycle Time）实时值
   - WIP深度热力图（工位库存积压）

**4. 瓶颈识别**
   - 产线空间布局图（2D平面）
   - 拥堵点热力标注（颜色深浅表示严重程度）
   - 堵塞/饥饿/平稳状态实时更新

### 1.2 交互设计

- 支持多产线切换（下拉选择框）
- 时间粒度切换（当天/当班/当周/自定义范围）
- 点击任意指标可下钻至详情页
- 鼠标悬停显示数据来源与时间戳

---

## 2. 问题检测模块

### 2.1 功能清单

| 功能点 | 详细说明 | 数据来源 |
|-------|---------|---------|
| 产线问题位置 | 在布局图上标注异常工位，支持实时闪烁提醒 | 洞微检测事件 |
| 问题列表 | 多维度分类展示（工位/类型/程度/时间） | 格物诊断结果 |
| 工位筛选 | 选择特定工位查看历史问题 | 本地筛选 |
| 问题类型分类 | 缺陷类别（划痕/污点/尺寸超差等） | 检测标签 |
| 缺陷程度排序 | 按影响损失金额降序 | 天筹损失评估 |
| 影响时间筛选 | 选择时间段查看历史记录 | 时序数据库 |

### 2.2 页面布局

```
┌────────────────────────────────────────┐
│  [工位下拉] [类型筛选] [时间选择器]      │
├────────────────────────────────────────┤
│  产线布局图（热力标注）                   │
├────────────────────────────────────────┤
│  问题列表表格                            │
│  ┌──────────────────────────────────┐  │
│  │ 时间 | 工位 | 类型 | 程度 | 操作    │  │
│  │ 14:32 | W05 | 划痕 | 高 | [查看] │  │
│  └──────────────────────────────────┘  │
└────────────────────────────────────────┘
```

---

## 3. 数据追溯与下钻

### 3.1 追溯路径设计

```
工单号
  → 选择工位
    → 选择时间段
      → 过站记录列表
        → 缺陷图像详情
          → 关联参数（温度/压力/转速）
            → 关联设备状态
```

### 3.2 缺陷图像墙

- 缩略图网格展示（6×4布局）
- 支持点击放大查看原图
- 支持缺陷类型筛选与搜索
- 图像元数据显示（拍摄时间、设备编号、置信度）

### 3.3 报表导出

- Excel格式：数据表 + 图表嵌入
- PDF格式：完整报告（封面 + 图表 + 数据表）
- 支持自定义时间范围与指标选择

---

## 4. 观澜API接口

| 接口路径 | 方法 | 说明 | 权限 |
|---------|------|------|------|
| `/api/v1/production/overview` | GET | 获取生产总览 | production:view |
| `/api/v1/production/realtime-status` | GET | 获取实时状态 | production:view |
| `/api/v1/production/bottleneck-analysis` | GET | 瓶颈分析 | production:view |
| `/api/v1/quality/yield-rate` | GET | 获取良率数据 | quality:view |
| `/api/v1/quality/defect-trends` | GET | 缺陷趋势 | quality:view |
| `/api/v1/quality/pareto-analysis` | GET | 帕累托分析 | quality:view |
| `/api/v1/tracing/work-order/{orderId}` | GET | 工单追溯 | tracing:view |
| `/api/v1/tracing/defect-images` | GET | 缺陷图像列表 | tracing:view |
| `/api/v1/reports/export` | POST | 导出报表 | report:export |