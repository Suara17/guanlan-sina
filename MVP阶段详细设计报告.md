
## 1. 一、MVP阶段目标与范围界定
 **核心原则**：
- 快速验证“数据可视化 + 异常决策闭环”的用户价值。
- 严格遵守文档要求：**指标口径一致、来源可追溯、动作可落地**。
- 只实现观澜和司南的核心路径，避免复杂交互（如知识图谱可视化、布局动画、工单闭环）。
- 所有数据通过事件驱动总线模拟或接入（MVP阶段可先用Mock数据，后期替换真实事件）。

**MVP交付范围**：
- **观澜**：核心仪表盘、生产总览、基本质量指标、缺陷图像展示、简单下钻追溯。
- **司南**：异常列表、简单诊断（文字版原因链）、方案对比表格（无布局/路径可视化）。
- 共享：统一登录、导航、实时数据推送基础。

**排除范围**（留到二期）：
- 知识图谱交互可视化。
- 布局/物流路径对比图、仿真动画。
- 工单生成与复盘回写。
- 大屏模式、移动端适配、复杂权限。

## 2. 二、用户角色与权限（简化版）
- **管理员/管理层**：完整查看观澜 + 司南。
- **工程师**：观澜查看 + 司南全功能。
- **现场人员**：仅观澜总览 + 司南异常列表（不可编辑）。
- MVP阶段使用简单用户名/密码登录，后期接入企业微信/钉钉。

## 3. 三、页面结构与导航设计
整体采用左右布局（企业级后台常见模式）：
- **左侧导航栏**：Logo + “观澜总览” / “司南决策” / “设置” / “退出”。
- **顶部栏**：当前产线选择器（下拉） + 用户信息 + 实时告警红点。
- **主内容区**：页面主体。

**页面列表**：
1. 登录页
2. 观澜 - 生产总览仪表盘（默认首页）
3. 观澜 - 质量指标详情页（从仪表盘下钻进入）
4. 观澜 - 缺陷追溯页（从质量指标进入）
5. 司南 - 异常列表页
6. 司南 - 异常详情页（诊断 + 方案）

## 4. 四、详细页面设计

### 4.1. 观澜 - 生产总览仪表盘（Dashboard）
**布局**：上中下三段式。
- **顶部卡片区**（横向4-5个卡片）：
  - 当日计划产量 vs 实际产量（进度条 + 数值）。
  - 预计完工时间（倒计时或时间点）。
  - 整体良品率 / 不良率（大数字 + 环比箭头）。
  - 当前瓶颈工位（文字 + 热力颜色）。
- **中间图表区**（两列）：
  - 左侧：生产进度甘特图或折线图（计划 vs 实际，X轴时间，Y轴产量）。
  - 右侧：不良率趋势折线图（按小时/班次）。
  - 下方：关键工位状态表格（工位名、CT、WIP深度、流速状态：绿色平稳/黄色饥饿/红色堵塞）。
- **底部**：实时告警滚动条（轻量列表，点击跳转司南异常列表）。

**交互**：
- 点击卡片/图表点 → 跳转质量指标详情页或直接高亮相关工位。
- 鼠标悬停任何指标 → Tooltip显示“数据来源：洞微模块，时间戳：XXXX”。

### 4.2. 观澜 - 质量指标详情页
**布局**：顶部筛选 + 图表 + 表格。
- **筛选栏**：时间范围（今天/昨天/自定义）、缺陷类型下拉、工位下拉。
- **主要内容**：
  - 帕累托图（Top10缺陷类型占比）。
  - 不良率趋势折线（可叠加多工位）。
  - 缺陷分布表格（缺陷类型、发生次数、占比、涉及工位）。
- **交互**：
  - 点击帕累托柱或表格行 → 跳转缺陷追溯页（带过滤条件）。

### 4.3. 观澜 - 缺陷追溯页
**布局**：顶部筛选 + 图像墙 + 详情表格。
- **筛选栏**：工单号、批次、时间段、缺陷类型。
- **图像墙**：网格展示缺陷缩略图（每张带时间戳、工位、缺陷标签），支持分页、点击放大（弹窗查看原图 + OK/NG标记）。
- **下方表格**：列表形式展示每条记录（时间、工位、缺陷类型、置信度、关联参数如温度/震动）。
- **交互**：
  - 放大图像时显示“来源：洞微终端，相机ID：XX”。
  - 支持导出当前页为Excel。

### 4.4. 司南 - 异常列表页
**布局**：顶部筛选 + 表格列表。
- **筛选**：状态（未处理/处置中/已关闭）、严重程度、时间范围。
- **表格列**：
  - 异常ID、触发时间、缺陷类型、影响工位、当前状态、严重程度（高/中/低）。
  - 操作列：查看详情按钮。
- **交互**：
  - 实时推送新异常（表格顶部插入 + 铃声/通知）。
  - 点击行 → 进入异常详情页。

### 4.5. 司南 - 异常详情页
**布局**：分三块卡片式垂直排列。
1. **异常概述卡片**：
   - 基本信息：触发时间、缺陷类型、连续不良数、影响范围（工位/产量预估损失）。
2. **诊断信息卡片**（简单文字版）：
   - 原因链：树形文字列表（根因 → 证据1 → 证据2）。
   - 证据列表：表格形式（参数名、当前值、正常范围、历史相似案例链接）。
   - 来源标注：格物模块输出。
3. **处置方案卡片**：
   - 方案对比表格（2-3个方案）：
     - 列：方案名称（生产优先/质量优先）、预计停机时间、成功率、期望损失、推荐度（星级或颜色）。
     - 每行末尾“采纳”按钮（MVP仅记录日志，不实际下发）。
   - 下方文字说明方案内容（纯文字描述动设备或动物流动作）。

**交互**：
- 所有数值悬停显示来源与计算口径。
- “返回列表”按钮。

## 5. 五、数据接口与事件总线（MVP实现方案）
**事件类型**（基于文档）：
- InspectionEvent：缺陷检测结果（缺陷类型、图像URL、工位、时间戳）。
- FlowEvent：节拍/WIP/状态（CT、WIP深度、流速）。
- DecisionPack：异常诊断 + 方案（原因链、方案表格数据）。

**后端接口**（RESTful，MVP阶段10-15个接口）：
- /api/dashboard/summary → 仪表盘卡片数据。
- /api/quality/trend → 不良率趋势。
- /api/quality/pareto → 帕累托数据。
- /api/defects/list → 缺陷记录 + 图像URL列表。
- /api/alerts/list → 异常列表。
- /api/alerts/{id} → 异常详情（含诊断 + 方案）。

**实时推送**：使用WebSocket简单实现（连接后订阅产线ID，推送新Event）。

**Mock策略**：MVP前期后端提供Mock服务，模拟定时推送事件。

## 6. 六、技术实现建议
**前端**：
- 框架：React 18 + TypeScript + Ant Design（或Arco Design）。
- 图表：Apache ECharts（简单强大）。
- 状态管理：Zustand（轻量）。
- 实时：Socket.io-client。
- 图像查看：Ant Design Image组件 + PreviewGroup。

**后端**：
- Node.js + NestJS（或Java Spring Boot）。
- WebSocket：Socket.io。
- 数据库：PostgreSQL（业务数据） + MinIO（图像存储）。

**部署**：
- Docker Compose单机部署（前端Nginx + 后端 + Mock DB）。
- 后期迁移K8s。

## 7. 七、验收标准
- 所有指标在不同页面显示一致（数值相同、时间戳对齐）。
- 从仪表盘 → 质量详情 → 缺陷追溯全链路流畅。
- 模拟异常触发 → 司南实时显示 → 详情页原因链与方案表格完整。
- 性能：页面加载<2s，实时更新<3s。
- 用户测试：管理层能快速看懂生产节奏，工程师能从异常获取处置建议。

此MVP设计聚焦核心价值链验证，后续迭代可快速扩展可视化交互与闭环执行。如需UI原型图、接口文档模板或具体组件代码示例，可进一步指定。