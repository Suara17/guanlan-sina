
### 0.1. 可视化平台需求分析报告

#### 0.1.1. 一、项目背景与平台定位

文档中可视化平台由两个核心子系统组成：

- **观澜（GuanLan）** ：生产可视化门户，主要面向管理层与现场人员，提供统一的“生产节奏 + 质量指标”总览与追溯入口，解决“去现场看、去系统查”的信息割裂问题。
- **司南（SiNan）** ：决策助手，主要面向异常处理场景，提供从“提醒 → 诊断 → 处置 → 复盘”的完整闭环，强调结构化、可解释、可落地的决策支持。

两个子系统统一作为Web应用层（网页系统），共享底层数据总线，界面风格、权限体系、数据口径需高度一致。整体目标是： **将底层模块（洞微、格物、天筹、浑天）产生的结构化数据与决策结果，以直观、可交互、可追溯的方式呈现给用户** ，最终支撑“检测提速 → 全局秩序优化”的价值链闭环。

#### 0.1.2. 二、用户角色与使用场景

1. **管理层（厂长/生产经理）**
	- 主要使用观澜总览页面，关注整体生产节奏、良率趋势、预计完工时间。
	- 偶尔进入司南查看重大异常的处置方案与ROI预演。
2. **工艺/质量工程师**
	- 深度使用司南的诊断、处置、复盘功能。
	- 在观澜中进行缺陷追溯与历史数据下钻。
3. **现场主管/操作员**
	- 主要看观澜的实时看板与工位级指标。
	- 司南异常提醒后快速查看处置建议并执行。
4. **维护/设备人员**
	- 关注司南中涉及设备移动或物流调整的具体指令。

#### 0.1.3. 三、功能需求分析

##### 0.1.3.1. 观澜（生产可视化门户）核心功能

1. **生产总览仪表盘（Dashboard）**
	- 实时展示：
		- 计划进度 vs 实际进度 vs 预计完工时间（甘特图或进度条）。
		- 整体良品率、不良率趋势（折线图）。
		- 关键工位CT、WIP深度、流速状态（堵塞/饥饿/平稳）。
		- 瓶颈工位热力图（空间布局图上标注拥堵点）。
	- 支持多产线切换、多时间粒度（当天/当班/当周）。
2. **质量指标展示**
	- 不良率分层展示：按缺陷类型、工位、批次、机台。
	- 趋势图 + 帕累托图（Top缺陷占比）。
	- 缺陷图像墙（缩略图网格，支持点击放大查看原始图像）。
3. **下钻与追溯**
	- 从总览点击任意指标 → 进入工位/批次详情页。
	- 追溯路径：工单号 → 工位 → 时间段 → 具体过站记录 + 缺陷图像 + 关联参数（温度、震动、刀具时长等）。
	- 支持导出报表（Excel/PDF）。
4. **实时告警区**
	- 轻量级告警列表（不良率超阈值、连续NG、瓶颈漂移等），点击可跳转司南处置页面。

##### 0.1.3.2. 司南（决策助手）核心功能

1. **异常提醒与列表**
	- 实时推送（WebSocket + 桌面通知）。
	- 异常列表：按严重程度排序，展示触发时间、缺陷类型、影响范围、当前状态（未处理/处置中/已关闭）。
2. **诊断详情页**
	- 原因链展示：格物模块输出的证据链（可视化知识图谱节点+关系）。
	- 证据列表：关联的工艺参数、设备状态、环境数据、历史相似案例。
	- 可交互展开/收起节点，支持搜索节点。
3. **处置方案推荐**
	- 天筹模块输出的多方案对比表格：
		- 方案类型（生产优先 vs 质量优先、动设备 vs 动物流）。
		- 关键指标：预计停机时间、成功率、不良外流风险、期望损失、ROI。
	- 方案可视化：
		- 轻资产：阵列重构前后布局对比图（拖拽式设备位置变化）。
		- 重资产：物流路径调整前后对比（AGV路径动画）。
	- 浑天仿真结果嵌入：关键风险点标注 + ROI预演报告（柱状图/数值）。
4. **执行与复盘**
	- 一键生成工单（包含处置指令、责任人、预计时长）。
	- 执行后填写实际结果（停机时长、是否成功、实际损失）。
	- 自动回写至案例库，更新策略成功率与阈值。
5. **历史案例库**
	- 可搜索、可过滤的案例列表，用于人工参考或模型迭代。

#### 0.1.4. 四、非功能需求

1. **性能要求**
	- 页面加载 < 2s，实时数据更新延迟 < 3s（WebSocket推送）。
	- 支持同时在线用户 ≥ 100（单产线规模）。
	- 大屏适配（车间看板模式，字体/间距放大）。
2. **安全性与权限**
	- 基于角色RBAC权限控制（查看/编辑/执行/审批）。
	- 数据敏感字段脱敏，操作日志完整审计。
	- 支持企业微信/钉钉单点登录。
3. **可靠性与可维护性**
	- 关键指标口径统一（所有页面同一指标来源同一服务）。
	- 数据来源可追溯（鼠标悬停显示数据来源模块 + 时间戳）。
	- 动作可落地（处置方案生成后可直接推送至MES/PLC或生成可打印工单）。
4. **可扩展性**
	- 模块化前端组件（仪表盘组件、知识图谱组件、布局对比组件可复用）。
	- 后端事件驱动架构（推荐使用Kafka/NATS作为数据总线）。
	- 支持多语言（中英文切换）、多主题（深色/浅色）。

#### 0.1.5. 五、技术架构建议

1. **前端技术栈**
	- 框架：React + TypeScript（推荐Ant Design Pro或Arco Design企业级组件库）。
	- 图表：ECharts 或 AntV G2/G6（知识图谱用G6）。
	- 状态管理：Redux Toolkit 或 Zustand。
	- 实时通信：WebSocket（Socket.io 或原生）。
	- 布局对比与动画：Konva.js 或 Three.js轻量层（2D足够）。
2. **后端技术栈**
	- 语言/框架：Node.js (NestJS) 或 Java (Spring Boot)，视团队熟悉度。
	- API风格：RESTful + GraphQL（知识图谱查询适合GraphQL）。
	- 数据总线：事件驱动，洞微上报InspectionEvent/FlowEvent → 消息队列 → 观澜/司南订阅消费。
	- 存储：
		- 时序指标 → InfluxDB 或 TimescaleDB。
		- 图像 → 对象存储（MinIO/AliOSS）。
		- 知识图谱 → Neo4j 或 JanusGraph。
		- 业务数据 → PostgreSQL。
3. **部署与运维**
	- 容器化：Docker + Kubernetes。
	- 前后端分离，Nginx反向代理。
	- CI/CD + 灰度发布。
