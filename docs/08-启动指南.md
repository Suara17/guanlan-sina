# 观澜系统前后端启动指南

## 项目概述

这是一个基于 FastAPI 全栈项目，包含前端（React + TypeScript）和后端（FastAPI + Python），使用 PostgreSQL 数据库。

## 前置条件

- 依赖已安装完成
- Docker 已启动，数据库服务运行在端口 5432
- Node.js 和 Python 环境已配置

## 技术栈

- **后端**: FastAPI, SQLModel, PostgreSQL, Uvicorn
- **前端**: React, TypeScript, Vite, TanStack Query, Tailwind CSS
- **数据库**: PostgreSQL (Docker)

## 启动步骤

### 1. 启动数据库

确保 PostgreSQL 数据库在 Docker 中运行：

```bash
# 数据库已在 docker-compose.local.yml 中配置
# 运行在 localhost:5432
```

### 2. 启动后端服务

```bash
cd backend
uv sync  # 安装依赖（如果尚未安装）
uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**后端访问地址**:
- API 服务器: http://localhost:8000
- API 文档: http://localhost:8000/docs
- API 文档 (ReDoc): http://localhost:8000/redoc

### 3. 启动前端服务

```bash
cd frontend
npm install  # 安装依赖（如果尚未安装）
npm run dev
```

**前端访问地址**:
- 前端应用: http://localhost:5173

## 服务状态检查

### 后端服务
- 访问 http://localhost:8000/docs 查看 API 文档
- 确认数据库连接正常

### 前端服务
- 访问 http://localhost:5173 查看前端界面
- 确认能够正常加载和交互

### 数据库服务
- 确认 PostgreSQL 在 localhost:5432 运行
- 检查数据库迁移是否完成

## 开发模式说明

### 本地开发
- 后端使用 `--reload` 参数，支持热重载
- 前端使用 Vite 开发服务器，支持热重载
- 代码修改后会自动重新加载

### Docker Compose 模式
如果需要使用完整的 Docker Compose 环境：

```bash
docker compose watch
```

这将启动完整的开发环境，包括 Traefik 反向代理等服务。

## 常见问题

### 后端启动失败
1. 检查数据库连接配置
2. 确认环境变量设置正确
3. 查看 `backend/.env` 文件配置

### 前端启动失败
1. 确认 Node.js 版本符合要求
2. 检查 `frontend/.env` 文件中的 API 地址配置
3. 确认后端服务正在运行

### 数据库连接问题
1. 确认 Docker 中的 PostgreSQL 服务正在运行
2. 检查数据库端口映射（5432）
3. 验证数据库用户和密码配置

## 环境变量配置

项目使用 `.env` 文件管理配置，请确保以下关键配置正确：

- 数据库连接信息
- JWT 密钥
- API 基础 URL
- CORS 设置

## 停止服务

要停止所有服务：

```bash
# 停止后端 (Ctrl+C)
# 停止前端 (Ctrl+C)
# 如果使用了 Docker Compose
docker compose down
```

## 后续步骤

1. 验证前后端交互正常
2. 运行测试用例
3. 检查代码质量（linting）
4. 部署到生产环境（如需要）
