# 天工·弈控前端系统优化开发方案

## 文档信息
- **项目名称**: 天工·弈控
- **版本**: 1.0
- **日期**: 2026-01-27
- **作者**: Kilo Code
- **范围**: 前端开发（暂时不涉及后端）

## 项目概述

天工·弈控是一个面向离散制造业的"视-空协同"智适应操作系统。本方案目前专注于前端系统优化，实现前端展示效果，所有数据使用Mock。

**技术栈**:
- **前端**: React 19 (Vite 6, TypeScript 5.8, Tailwind CSS, Biome, Recharts)

## 优化需求分析

基于《15-系统优化方案20260126.txt》文档，主要前端优化需求包括：

### 1. 生产可视化界面优化
- **左侧数据看板**: 当日计划完成率、生产/计划生产、出勤人数、工时效率、产值
- **产线选择**: 左上角下拉框选择不同产线（SMT智能产线A01
SMT智能产线A02
SMT智能产线A03
PCB智能产线B01
PCB智能产线B02
PCB智能产线B03
3C智能产线C01
3C智能产线C02
3C智能产线C03）
- **异常信息**: 右侧根据产线类型切换显示对应异常：
- SMT智能产线常见异常

   1. SMT贴片机#3吸嘴漏气，连续3次检测失败
   2. SMT贴片机#1密脚IC引脚短路，发生率0.12%
   3. 回流焊#2环境振动超标，偏移量5微米
   4. SMT贴片机#2重型元件高空抛料，发生率0.08%
   5. SMT贴片机#1供料站位距离过远，行程超过200mm
   6. SMT印刷机#1焊膏印刷不均，厚度偏差±15微米

  PCB智能产线常见异常

   1. PCB蚀刻机#1蚀刻不净，残铜密度1.5个/PNL
   2. PCB曝光机#2曝光异物遮挡，缺陷率0.8%
   3. PCB钻孔房粉尘超标，PM2.5浓度150μg/m³
   4. PCB层压机#1多层板爆板，报废率2.3%
   5. PCB存储区#1湿度超标，当前湿度75%RH
   6. PCB电镀线#2铜层厚度不均，偏差±8微米

  33C智能产线常见异常

	1. 组装线工站#5瓶颈堆积，WIP数量超过50件
   2. 锁螺丝机#2节拍不匹配，作业时间35秒
   3. 自动化设备#3宕机，停机时间45分钟
   4. AGV小车#8路径死锁，等待时间120秒
   5. 返修通道#1逆向传输，碰撞风险等级高
   6. 物流传送带#2外壳划伤，报废率0.3%

### 2. 异常处理流程优化
- **点击异常跳转**: 跳转到格物图谱页面显示知识图谱
- **知识图谱可视化**: 现象-原因链路-解决方案的图谱展示

### 3. 天筹优化页面调整
- **决策计算**: 去掉权重设置，直接运行算法
- **结果展示**: 显示方案描述、期望损失，
预计维修时长：XX 分钟（区间）

修复成功概率：XX%

继续生产的流出风险：XX%（对应可能损失）

停线对交付影响：延迟 XX 小时/天（可选补救方案）

### 4. 浑天仿真页面增强
- **设备重排仿真**: 动态显示机器位置交换
- **线路优化动画**: 显示路径调整的动态流程

## 现有系统评估

### 前端页面现状
- ✅ **Dashboard.tsx**: 基础生产可视化，但缺少数据看板和产线选择
- ✅ **Tianchou.tsx**: 天筹优化页面，需调整决策计算逻辑
- ✅ **Huntian.tsx**: 浑天仿真页面，需增加设备重排动画
- ❌ **格物图谱页面**: 需要新建

### 数据状态
- 前端使用Mock数据，完全不依赖后端
- 所有展示效果通过前端实现

## 前端架构设计

## 功能模块设计

### 1. 生产可视化界面 (Dashboard)

#### 组件结构
```
Dashboard/
├── ProductionLineSelector.tsx    # 产线选择下拉框
├── DataDashboard.tsx           # 左侧数据看板
├── AnomalyList.tsx             # 右侧异常列表
├── ProductionChart.tsx         # 生产趋势图表
└── QualityChart.tsx            # 质量饼图
```

#### 状态管理
```typescript
interface DashboardState {
  selectedLine: ProductionLine | null;
  dashboardData: DashboardData;
  anomalies: Anomaly[];
  isLoading: boolean;
}
```

### 2. 格物图谱页面 (KnowledgeGraph)

#### 组件结构
```
KnowledgeGraph/
├── GraphCanvas.tsx             # 图谱画布 (使用D3.js)
├── NodeDetails.tsx             # 节点详情面板
├── RelationLines.tsx           # 关系连线
├── Legend.tsx                  # 图例说明
└── ActionButtons.tsx           # 操作按钮
```

#### 数据结构
```typescript
interface KnowledgeNode {
  id: string;
  type: 'phenomenon' | 'cause' | 'solution';
  content: string;
  level: number;
  x: number;
  y: number;
}

interface KnowledgeRelation {
  from: string;
  to: string;
  type: string;
}
```

### 3. 天筹优化页面 (Tianchou) - 调整

#### 主要变更
- 移除权重设置界面
- 增加原因和解决方案展示
- 优化决策计算结果展示
- 添加跳转到仿真页面的按钮

### 4. 浑天仿真页面 (Huntian) - 增强

#### 新增功能
- 设备重排动画：机器方框位置交换
- 线路优化动画：路径箭头方向调整
- 仿真参数配置：重排方案选择

## 前端开发实施计划

### 开发任务清单

**目标**: 完成前端系统优化，实现前端展示效果（暂时不涉及后端，所有数据使用Mock）

**任务详情**:
- [ ] 完善Dashboard页面：添加左侧数据看板（当日计划完成率、生产/计划生产、出勤人数、工时效率、产值），左上角添加产线下拉框，右侧异常信息根据选择的产线动态切换显示对应的异常
- [ ] 创建格物图谱页面：实现知识图谱可视化显示异常信息（现象、原因链、解决方案），包含文字描述和跳转到天筹页面的按钮
- [ ] 修改天筹优化页面：从格物图谱接收原因和解决方案数据，进行决策计算，输出预计维修时长、修复成功概率、继续生产的流出风险、停线对交付影响等信息
- [ ] 修改浑天仿真页面：根据天筹优化方案进行设备重排或线路优化的动态仿真演示
- [ ] 更新路由配置：添加格物图谱页面的路由，并确保页面间导航正常
- [ ] 更新类型定义：添加格物图谱、天筹优化、浑天仿真相关的数据类型
- [ ] 测试页面间数据传递和导航：确保从Dashboard点击异常跳转到格物图谱，从格物图谱跳转到天筹，从天筹跳转到浑天

**负责人**: 前端开发团队
**时间**: 立即开始实施
**预计完成时间**: 1-2周

## 技术栈和依赖

### 前端新增依赖
```json
{
  "d3": "^7.8.0",           // 知识图谱可视化
  "framer-motion": "^10.0.0", // 动画效果
  "@types/d3": "^7.4.0"     // TypeScript类型
}
```

## 风险评估

### 技术风险
1. **知识图谱可视化复杂度**: D3.js学习曲线陡峭，需要专门培训
2. **动画性能**: 复杂动画可能影响页面性能，需要优化
3. **Mock数据管理**: 前端展示阶段需要维护大量Mock数据

### 业务风险
1. **需求理解偏差**: 异常分类和知识图谱结构需要业务专家确认
2. **用户接受度**: 新界面设计需要用户反馈调整

### 缓解措施
- 提前进行技术预研和原型验证
- 建立业务专家评审机制
- 实施敏捷开发，快速迭代反馈

## 验收标准

### 功能验收
- [ ] 产线选择和数据看板正常显示（Mock数据）
- [ ] 异常信息根据产线正确切换
- [ ] 知识图谱页面正常展示和交互
- [ ] 决策计算功能正常运行（Mock算法）
- [ ] 仿真动画流畅播放
- [ ] 页面间导航和数据传递正常

### 性能验收
- [ ] 页面加载时间 < 3秒
- [ ] 图谱渲染时间 < 2秒
- [ ] 动画帧率 > 30fps

### 兼容性验收
- [ ] 支持Chrome 90+, Firefox 88+, Safari 14+
- [ ] 响应式设计适配移动端

---

*本文档为系统优化开发方案的完整规划，实施过程中可根据实际情况进行调整。*