# PostgreSQL 数据表字段说明

## 1. production_lines - 产线信息表

存储工厂中各条生产线的相关信息。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| line_id | VARCHAR(50) | PRIMARY KEY | 产线唯一标识符，主键 |
| line_name | VARCHAR(100) | NOT NULL | 产线名称，如"总装线A" |
| factory_id | VARCHAR(50) | NOT NULL | 所属工厂ID |
| status | VARCHAR(20) | DEFAULT 'active' | 产线配置状态：active（启用）、inactive（停用）、maintenance（维护中） |
| current_status | VARCHAR(20) | DEFAULT 'idle' | 产线实时运行状态：running（运行中）、timeout（超时）、idle（空闲）、maintenance（维护） |
| current_plan_id | VARCHAR(50) | FOREIGN KEY | 当前执行的生产计划ID，关联production_plans表 |
| bottleneck_station_id | VARCHAR(50) | FOREIGN KEY | 当前瓶颈工位ID，关联stations表 |
| last_updated | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 实时状态最后更新时间 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 记录创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 记录最后更新时间 |

---

## 2. stations - 工位信息表

存储产线中各个工位的详细信息。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| station_id | VARCHAR(50) | PRIMARY KEY | 工位唯一标识符，主键 |
| station_name | VARCHAR(100) | NOT NULL | 工位名称，如"焊接工位" |
| line_id | VARCHAR(50) | FOREIGN KEY | 所属产线ID，关联production_lines表 |
| station_type | VARCHAR(50) | - | 工位类型，如"人工"、"自动化"、"质检"等 |
| sequence_order | INT | - | 工位在产线中的顺序号 |
| equipment_ids | TEXT[] | - | 该工位关联的设备ID数组 |
| current_cycle_time | DECIMAL(10, 2) | - | 当前CT值（Cycle Time，周期时间），单位：秒 |
| wip_quantity | INT | DEFAULT 0 | 当前WIP数量（在制品数量），用于热力图显示 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 记录创建时间 |

---

## 3. anomalies - 异常记录表

记录生产过程中发生的各类异常和缺陷。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| anomaly_id | VARCHAR(50) | PRIMARY KEY | 异常记录唯一标识符，主键 |
| line_id | VARCHAR(50) | FOREIGN KEY | 发生异常的产线ID |
| station_id | VARCHAR(50) | FOREIGN KEY | 发生异常的工位ID |
| defect_type | VARCHAR(100) | - | 缺陷类型，如"焊接不良"、"尺寸偏差"等 |
| severity | VARCHAR(20) | - | 严重程度：critical（严重）、major（主要）、minor（次要） |
| detected_at | TIMESTAMP | NOT NULL | 异常检测时间 |
| status | VARCHAR(20) | DEFAULT 'open' | 异常状态：open（待处理）、in_progress（处理中）、resolved（已解决）、closed（已关闭） |
| assigned_to | VARCHAR(50) | - | 指派给谁处理（用户ID） |
| root_cause | TEXT | - | 根本原因分析结果 |
| solution_id | VARCHAR(50) | FOREIGN KEY | 采用的处置方案ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 记录创建时间 |
| closed_at | TIMESTAMP | - | 异常关闭时间 |

---

## 4. solutions - 处置方案表

存储针对异常的各类处置方案及其评估信息。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| solution_id | VARCHAR(50) | PRIMARY KEY | 方案唯一标识符，主键 |
| anomaly_id | VARCHAR(50) | FOREIGN KEY | 关联的异常记录ID |
| solution_type | VARCHAR(50) | - | 方案类型，如"立即停机"、"降级运行"、"临时修复"等 |
| solution_name | VARCHAR(200) | - | 方案名称 |
| description | TEXT | - | 方案详细描述 |
| estimated_downtime_hours | DECIMAL(10, 2) | - | 预计停工时长（小时） |
| success_rate | DECIMAL(5, 2) | - | 预计成功率（百分比） |
| expected_loss | DECIMAL(15, 2) | - | 预计损失金额 |
| roi | DECIMAL(10, 2) | - | 投资回报率 |
| simulation_result | JSONB | - | 仿真模拟结果（JSON格式存储） |
| recommended | BOOLEAN | DEFAULT FALSE | 是否为推荐方案 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 方案创建时间 |

---

## 5. work_orders - 执行工单表

记录处置方案的具体执行工单。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| order_id | VARCHAR(50) | PRIMARY KEY | 工单唯一标识符，主键 |
| solution_id | VARCHAR(50) | FOREIGN KEY | 关联的处置方案ID |
| order_type | VARCHAR(50) | - | 工单类型，如"维修"、"更换"、"调试"等 |
| responsible_person | VARCHAR(100) | - | 负责人姓名 |
| instructions | TEXT | - | 执行说明和操作指引 |
| estimated_duration_hours | DECIMAL(5, 2) | - | 预计执行时长（小时） |
| actual_duration_hours | DECIMAL(5, 2) | - | 实际执行时长（小时） |
| status | VARCHAR(20) | DEFAULT 'pending' | 工单状态：pending（待执行）、in_progress（执行中）、completed（已完成）、cancelled（已取消） |
| execution_result | VARCHAR(20) | - | 执行结果：success（成功）、partial（部分成功）、failed（失败） |
| actual_loss | DECIMAL(15, 2) | - | 实际损失金额 |
| notes | TEXT | - | 执行备注和说明 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 工单创建时间 |
| started_at | TIMESTAMP | - | 开始执行时间 |
| completed_at | TIMESTAMP | - | 完成时间 |

---

## 6. case_library - 案例库表

存储历史案例，用于知识积累和经验复用。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| case_id | VARCHAR(50) | PRIMARY KEY | 案例唯一标识符，主键 |
| anomaly_id | VARCHAR(50) | FOREIGN KEY | 关联的异常记录ID |
| problem_description | TEXT | - | 问题描述 |
| diagnosis_result | JSONB | - | 诊断结果（JSON格式存储） |
| solution_adopted | VARCHAR(50) | - | 采用的方案ID |
| expected_effect | JSONB | - | 预期效果（JSON格式存储） |
| actual_effect | JSONB | - | 实际效果（JSON格式存储） |
| lessons_learned | TEXT | - | 经验教训总结 |
| tags | TEXT[] | - | 案例标签数组，用于分类和检索 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 案例创建时间 |

---

## 7. users - 用户表

存储系统用户信息及权限配置。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| user_id | VARCHAR(50) | PRIMARY KEY | 用户唯一标识符，主键 |
| username | VARCHAR(100) | UNIQUE, NOT NULL | 用户名，唯一且不能为空 |
| email | VARCHAR(100) | - | 邮箱地址 |
| phone | VARCHAR(20) | - | 联系电话 |
| role | VARCHAR(50) | - | 用户角色，如"admin"、"operator"、"manager"等 |
| factory_ids | TEXT[] | - | 可访问的工厂ID数组 |
| line_ids | TEXT[] | - | 可访问的产线ID数组 |
| permissions | TEXT[] | - | 扩展RBAC权限列表，存储具体权限标识 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 用户创建时间 |
| last_login_at | TIMESTAMP | - | 最后登录时间 |

---

## 8. audit_logs - 操作日志表

记录用户在系统中的所有操作，用于审计和安全追踪。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| log_id | BIGSERIAL | PRIMARY KEY | 日志唯一标识符，自增主键 |
| user_id | VARCHAR(50) | - | 操作用户ID |
| action | VARCHAR(100) | - | 操作类型，如"create"、"update"、"delete"、"view"等 |
| resource_type | VARCHAR(50) | - | 操作的资源类型，如"anomaly"、"solution"、"work_order"等 |
| resource_id | VARCHAR(50) | - | 操作的资源ID |
| ip_address | VARCHAR(50) | - | 操作来源IP地址 |
| user_agent | TEXT | - | 客户端用户代理信息（浏览器/设备信息） |
| request_body | JSONB | - | 请求体内容（JSON格式） |
| response_status | INT | - | HTTP响应状态码 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 日志创建时间（操作发生时间） |

---

## 9. production_plans - 生产计划表

存储生产计划信息，用于观澜系统的生产总览仪表盘。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| plan_id | VARCHAR(50) | PRIMARY KEY | 生产计划唯一标识符，主键 |
| line_id | VARCHAR(50) | FOREIGN KEY | 所属产线ID，关联production_lines表 |
| product_id | VARCHAR(50) | - | 产品ID |
| product_name | VARCHAR(200) | - | 产品名称 |
| planned_quantity | INT | NOT NULL | 计划生产量（目标值） |
| actual_quantity | INT | DEFAULT 0 | 实时生产量（当前完成数） |
| start_time | TIMESTAMP | NOT NULL | 计划开始时间 |
| estimated_completion_time | TIMESTAMP | - | 预计完成时间（基于流速预测） |
| actual_completion_time | TIMESTAMP | - | 实际完成时间 |
| status | VARCHAR(20) | DEFAULT 'planned' | 计划状态：planned（计划中）、running（运行中）、completed（已完成）、timeout（超时） |
| created_by | VARCHAR(50) | - | 创建人ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 计划创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 计划最后更新时间 |

---

## 10. production_records - 生产记录表

记录实时生产数据，用于生产进度跟踪和质量统计。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| record_id | BIGSERIAL | PRIMARY KEY | 生产记录唯一标识符，自增主键 |
| plan_id | VARCHAR(50) | FOREIGN KEY | 关联的生产计划ID |
| line_id | VARCHAR(50) | FOREIGN KEY | 产线ID，关联production_lines表 |
| station_id | VARCHAR(50) | FOREIGN KEY | 工位ID，关联stations表 |
| product_id | VARCHAR(50) | - | 产品ID |
| batch_id | VARCHAR(50) | - | 批次号 |
| quantity | INT | DEFAULT 1 | 生产数量 |
| quality_status | VARCHAR(20) | - | 质量状态：good（良品）、defect（不良品）、rework（返工） |
| defect_type | VARCHAR(100) | - | 缺陷类型，如"划痕"、"污点"、"尺寸超差"等 |
| cycle_time | DECIMAL(10, 2) | - | 实际CT值（周期时间），单位：秒 |
| recorded_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 记录时间 |

---

## 11. quality_metrics - 质量指标表

存储质量指标统计数据，用于观澜系统的质量看板。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| metric_id | BIGSERIAL | PRIMARY KEY | 质量指标唯一标识符，自增主键 |
| plan_id | VARCHAR(50) | FOREIGN KEY | 关联的生产计划ID |
| line_id | VARCHAR(50) | FOREIGN KEY | 产线ID，关联production_lines表 |
| station_id | VARCHAR(50) | FOREIGN KEY | 工位ID，关联stations表（NULL表示产线整体指标） |
| total_produced | INT | DEFAULT 0 | 总产量 |
| good_quantity | INT | DEFAULT 0 | 良品数量 |
| defect_quantity | INT | DEFAULT 0 | 不良品数量 |
| rework_quantity | INT | DEFAULT 0 | 返工数量 |
| yield_rate | DECIMAL(5, 2) | - | 良品率（百分比），如95.50 |
| defect_rate | DECIMAL(5, 2) | - | 不良品率（百分比），如4.50 |
| calculated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 计算时间 |

---

## 12. defect_details - 缺陷明细表

存储缺陷详细信息，支持缺陷图像墙功能。

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| defect_id | BIGSERIAL | PRIMARY KEY | 缺陷记录唯一标识符，自增主键 |
| record_id | BIGINT | FOREIGN KEY | 关联的生产记录ID |
| plan_id | VARCHAR(50) | FOREIGN KEY | 关联的生产计划ID |
| line_id | VARCHAR(50) | FOREIGN KEY | 产线ID，关联production_lines表 |
| station_id | VARCHAR(50) | FOREIGN KEY | 工位ID，关联stations表 |
| defect_type | VARCHAR(100) | - | 缺陷类型，如"划痕"、"污点"、"尺寸超差"等 |
| severity | VARCHAR(20) | - | 缺陷严重程度：high（高）、medium（中）、low（低） |
| defect_image_url | TEXT | - | 缺陷图像URL（MinIO对象存储路径） |
| confidence | DECIMAL(5, 2) | - | 检测置信度（百分比），如98.50 |
| detected_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 检测时间 |

---

## 数据类型说明

- **VARCHAR(n)**: 变长字符串，最大长度为n
- **TEXT**: 不限长度的文本
- **INT**: 整数
- **DECIMAL(m, d)**: 定点数，m为总位数，d为小数位数
- **TIMESTAMP**: 时间戳，精确到秒
- **BOOLEAN**: 布尔值（true/false）
- **TEXT[]**: 文本数组，可存储多个字符串值
- **JSONB**: 二进制JSON格式，支持高效的JSON查询和索引
- **BIGSERIAL**: 自增大整数

## 约束说明

- **PRIMARY KEY**: 主键，唯一标识表中每条记录
- **FOREIGN KEY**: 外键，关联到其他表的字段，维护数据一致性
- **NOT NULL**: 非空约束，字段必须有值
- **UNIQUE**: 唯一约束，字段值不能重复
- **DEFAULT**: 默认值，插入记录时未指定值时使用默认值
