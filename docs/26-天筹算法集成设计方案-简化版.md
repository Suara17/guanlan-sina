# å¤©ç­¹ç®—æ³•é›†æˆè®¾è®¡æ–¹æ¡ˆ (ç®€åŒ–ç‰ˆ)

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 ç®—æ³•ç³»ç»Ÿç®€ä»‹

å¤©ç­¹(Tianchou)æ™ºèƒ½åˆ¶é€ å†³ç­–ç³»ç»Ÿæ˜¯ä¸€ä¸ª**åŒè½¨å¤šç›®æ ‡ä¼˜åŒ–**å¹³å°ï¼ŒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

#### Part 1: æŠ€æœ¯ä¼˜åŒ– (NSGA-IIé—ä¼ ç®—æ³•)

| æ¨¡å¼ | é€‚ç”¨è¡Œä¸š | ä¼˜åŒ–ç›®æ ‡ | è¾“å…¥å‚æ•° | è¾“å‡ºæŒ‡æ ‡ |
|------|----------|----------|----------|----------|
| è½»å·¥ä¸šæ¨¡å¼ | çººç»‡ã€æœè£…ã€å®¶å…· | è½¦é—´è®¾å¤‡å¸ƒå±€ä¼˜åŒ– | è½¦é—´å°ºå¯¸ã€è®¾å¤‡æ•°é‡ã€æ¬è¿é¢‘ç‡çŸ©é˜µã€äº§å“çº¿ä¿¡æ¯ | æ¬è¿æˆæœ¬(f1)ã€è®¾å¤‡ç§»åŠ¨æˆæœ¬(f2)ã€ç©ºé—´åˆ©ç”¨ç‡(f3) |
| é‡å·¥ä¸šæ¨¡å¼ | æ±½è½¦åˆ¶é€ ã€æœºæ¢°åŠ å·¥ | AGVè°ƒåº¦è·¯å¾„ä¼˜åŒ– | å·¥ä½åæ ‡ã€AGVæ•°é‡ã€ä»»åŠ¡åˆ†é… | å®Œå·¥æ—¶é—´(f1)ã€ç“¶é¢ˆåˆ©ç”¨ç‡(f2) |

#### Part 2: å•†ä¸šå†³ç­– (AHP-TOPSIS)

- **ä»£è¡¨æ€§æ–¹æ¡ˆç­›é€‰**: ä½æˆæœ¬ã€çŸ­å·¥æœŸã€é«˜æ”¶ç›Šã€æ€§ä»·æ¯”ã€ä¸­å¿ƒç‚¹
- **AHPæƒé‡è®¡ç®—**: ç”¨æˆ·äº¤äº’å¼ä¸¤ä¸¤æ¯”è¾ƒï¼Œä¸€è‡´æ€§æ£€éªŒ
- **TOPSISç»¼åˆè¯„åˆ†**: å¤šå‡†åˆ™å†³ç­–æ’åºï¼Œæ¨èæœ€ä¼˜æ–¹æ¡ˆ

### 1.2 ç®€åŒ–è¯´æ˜

**ä¸åŸæ–¹æ¡ˆçš„åŒºåˆ«:**
- âŒ ç§»é™¤ Celery å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
- âŒ ç§»é™¤ Redis ç¼“å­˜
- âœ… ä½¿ç”¨ FastAPI BackgroundTasks å¤„ç†ä¼˜åŒ–ä»»åŠ¡
- âœ… ä¿ç•™æ‰€æœ‰æ•°æ®åº“æ¨¡å‹å’Œè¡¨
- âœ… ä¿ç•™æ‰€æœ‰ API ç«¯ç‚¹
- âœ… ç®—æ³•æ¨¡å—å®Œå…¨åŸºäº test6 ä»£ç ç»“æ„

---

## äºŒã€åç«¯è®¾è®¡

### 2.1 ä¾èµ–å®‰è£…

```bash
# åœ¨ backend ç¯å¢ƒä¸­å®‰è£…ç®—æ³•ä¾èµ–
cd backend
uv pip install deap numpy matplotlib pandas tqdm pymoo
```

### 2.2 ç›®å½•ç»“æ„

```
backend/app/
â”œâ”€â”€ algorithms/                    # ç®—æ³•æ¨¡å— (åŸºäºtest6)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ part1_optimization.py      # Part 1: æŠ€æœ¯ä¼˜åŒ– (NSGA-II)
â”‚   â”œâ”€â”€ part2_decision.py          # Part 2: å•†ä¸šå†³ç­– (AHP-TOPSIS)
â”‚   â”œâ”€â”€ scheme_translator.py       # æŠ€æœ¯->å•†ä¸šä»·å€¼è½¬æ¢
â”‚   â””â”€â”€ visualizer.py              # ç»“æœå¯è§†åŒ–å·¥å…·
â”œâ”€â”€ api/
â”‚   â””â”€â”€ routes/
â”‚       â””â”€â”€ tianchou.py            # å¤©ç­¹APIè·¯ç”±
â””â”€â”€ models.py                      # æ•°æ®åº“æ¨¡å‹ (æ·»åŠ å¤©ç­¹ç›¸å…³æ¨¡å‹)
```

### 2.3 æ•°æ®åº“æ¨¡å‹è®¾è®¡

åœ¨ `backend/app/models.py` ä¸­æ·»åŠ ä»¥ä¸‹æ¨¡å‹ï¼š

```python
from enum import Enum
from sqlalchemy import Column
from sqlalchemy.dialects.postgresql import JSONB

class IndustryType(str, Enum):
    LIGHT = "light"   # è½»å·¥ä¸š
    HEAVY = "heavy"   # é‡å·¥ä¸š

class TaskStatus(str, Enum):
    PENDING = "pending"
    RUNNING = "running"
    COMPLETED = "completed"
    FAILED = "failed"

class OptimizationTask(SQLModel, table=True):
    """ä¼˜åŒ–ä»»åŠ¡ä¸»è¡¨"""
    __tablename__ = "optimization_tasks"

    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)
    name: str = Field(index=True, max_length=255)
    industry_type: IndustryType

    # è¾“å…¥å‚æ•° (JSONå­˜å‚¨)
    input_params: dict = Field(default={}, sa_column=Column(JSONB))

    # ä»»åŠ¡çŠ¶æ€
    status: TaskStatus = Field(default=TaskStatus.PENDING)
    progress: int = Field(default=0)  # 0-100

    # ç»“æœæ‘˜è¦
    pareto_solution_count: int = Field(default=0)
    recommended_solution_id: uuid.UUID | None = Field(default=None)

    # å•†ä¸šå†³ç­–æƒé‡
    weights_cost: float | None = Field(default=None)
    weights_time: float | None = Field(default=None)
    weights_benefit: float | None = Field(default=None)

    # å…ƒæ•°æ®
    created_at: datetime = Field(default_factory=datetime.utcnow)
    started_at: datetime | None = None
    completed_at: datetime | None = None
    created_by: uuid.UUID | None = Field(default=None, foreign_key="users.id")

    # å…³è”å…³ç³»
    solutions: list["ParetoSolution"] = Relationship(back_populates="task", cascade_delete=True)
    decisions: list["DecisionRecord"] = Relationship(back_populates="task", cascade_delete=True)

class ParetoSolution(SQLModel, table=True):
    """å¸•ç´¯æ‰˜æœ€ä¼˜è§£"""
    __tablename__ = "pareto_solutions"

    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)
    task_id: uuid.UUID = Field(foreign_key="optimization_tasks.id", index=True)

    # æŠ€æœ¯æŒ‡æ ‡ (Part 1)
    f1: float  # ç›®æ ‡1
    f2: float  # ç›®æ ‡2
    f3: float | None = None  # ç›®æ ‡3 (è½»å·¥ä¸š)

    # å•†ä¸šæŒ‡æ ‡ (Part 2)
    total_cost: float = Field(default=0)
    implementation_days: float = Field(default=0)
    expected_benefit: float = Field(default=0)

    # æ–¹æ¡ˆè¯¦æƒ… (JSON)
    solution_data: dict = Field(default={}, sa_column=Column(JSONB))

    # è®¾å¤‡/è·¯å¾„æ–¹æ¡ˆ (JSON)
    technical_details: dict = Field(default={}, sa_column=Column(JSONB))

    # æ’åå’Œè¯„åˆ†
    rank: int = Field(default=0)
    topsis_score: float | None = None

    # å…³è”
    task: OptimizationTask = Relationship(back_populates="solutions")

class DecisionRecord(SQLModel, table=True):
    """å†³ç­–è®°å½• (AHP-TOPSIS)"""
    __tablename__ = "decision_records"

    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)
    task_id: uuid.UUID = Field(foreign_key="optimization_tasks.id", index=True)

    # AHPåˆ¤æ–­çŸ©é˜µ
    ahp_matrix: dict = Field(default={}, sa_column=Column(JSONB))

    # è®¡ç®—æƒé‡
    weights: dict = Field(default={}, sa_column=Column(JSONB))
    consistency_ratio: float = Field(default=0)

    # TOPSISç»“æœ
    best_solution_id: uuid.UUID | None = None
    decision_scores: dict = Field(default={}, sa_column=Column(JSONB))

    created_at: datetime = Field(default_factory=datetime.utcnow)

    task: OptimizationTask = Relationship(back_populates="decisions")
```

### 2.4 ç®—æ³•æ¨¡å—è®¾è®¡ (åŸºäºtest6)

#### 2.4.1 Part 1: æŠ€æœ¯ä¼˜åŒ–æ¨¡å—

`backend/app/algorithms/part1_optimization.py` - ç›´æ¥ä» test6 è¿ç§»æ ¸å¿ƒä»£ç 

ä¸»è¦ç±»å’Œå‡½æ•°ï¼š
- `DualTrackAlgorithm`: åŒè½¨ç®—æ³•ä¸»ç±»
- `run_light_industry_optimization()`: è½»å·¥ä¸šä¼˜åŒ–
- `run_heavy_industry_optimization()`: é‡å·¥ä¸šä¼˜åŒ–

#### 2.4.2 Part 2: å•†ä¸šå†³ç­–æ¨¡å—

`backend/app/algorithms/part2_decision.py` - ç›´æ¥ä» test6 è¿ç§»æ ¸å¿ƒä»£ç 

ä¸»è¦å‡½æ•°ï¼š
- `select_representative_solutions()`: ç­›é€‰ä»£è¡¨æ€§æ–¹æ¡ˆ
- `ahp_weight_calculation()`: AHPæƒé‡è®¡ç®—
- `topsis_ranking()`: TOPSISæ’åº

#### 2.4.3 è½¬æ¢å±‚æ¨¡å—

`backend/app/algorithms/scheme_translator.py` - ä» test6/main_tianchou.py æå–

```python
class SchemeTranslator:
    """æŠ€æœ¯æŒ‡æ ‡ -> å•†ä¸šæŒ‡æ ‡è½¬æ¢å™¨"""

    def __init__(self, industry_type: str, params: dict):
        self.industry_type = industry_type
        self.P_unit = params.get('P_unit', 20000)
        self.base_cost = params.get('base_cost', 50000)
        # ... å…¶ä»–å‚æ•°

    def translate(self, technical_solutions: list) -> tuple:
        """
        å°†æŠ€æœ¯ä¼˜åŒ–ç»“æœè½¬æ¢ä¸ºå•†ä¸šæŒ‡æ ‡

        Returns:
            (business_data, original_indices)
        """
        # å®ç°é€»è¾‘å‚è€ƒ test6/main_tianchou.py
        pass
```

### 2.5 APIè·¯ç”±è®¾è®¡

`backend/app/api/routes/tianchou.py`:

```python
from fastapi import APIRouter, Depends, HTTPException, BackgroundTasks
from sqlmodel import Session, select
from app.core.db import get_session
from app.models import OptimizationTask, ParetoSolution, DecisionRecord, TaskStatus
from app.algorithms import part1_optimization, part2_decision, scheme_translator
import numpy as np

router = APIRouter(prefix="/api/v1/tianchou", tags=["å¤©ç­¹ä¼˜åŒ–"])

# ============ è¯·æ±‚/å“åº”æ¨¡å‹ ============

class OptimizationRequest(BaseModel):
    """ä¼˜åŒ–ä»»åŠ¡è¯·æ±‚"""
    name: str
    industry_type: str  # "light" or "heavy"

    # è½»å·¥ä¸šå‚æ•°
    workshop_length: float | None = None
    workshop_width: float | None = None
    device_count: int | None = None
    # ... å…¶ä»–å‚æ•°

    # é‡å·¥ä¸šå‚æ•°
    station_count: int | None = None
    agv_count: int | None = None
    # ... å…¶ä»–å‚æ•°

    # å•†ä¸šå‚æ•°
    daily_output_value: float = 20000
    base_cost: float = 20000
    construction_rate: float = 3000

# ============ åå°ä»»åŠ¡å‡½æ•° ============

def run_optimization_task(task_id: str, session: Session):
    """åå°æ‰§è¡Œä¼˜åŒ–ä»»åŠ¡"""
    try:
        # 1. æ›´æ–°ä»»åŠ¡çŠ¶æ€
        task = session.get(OptimizationTask, task_id)
        task.status = TaskStatus.RUNNING
        task.started_at = datetime.utcnow()
        session.commit()

        # 2. æ‰§è¡Œ Part 1: æŠ€æœ¯ä¼˜åŒ–
        if task.industry_type == "light":
            optimizer = part1_optimization.DualTrackAlgorithm()
            results = optimizer.run_light_industry_optimization(task.input_params)
        else:
            optimizer = part1_optimization.DualTrackAlgorithm()
            results = optimizer.run_heavy_industry_optimization(task.input_params)

        pareto_solutions = results['pareto_solutions']

        # 3. æ‰§è¡Œå•†ä¸šä»·å€¼æ˜ å°„
        translator = scheme_translator.SchemeTranslator(
            task.industry_type,
            task.input_params
        )
        business_data, original_indices = translator.translate(pareto_solutions)

        # 4. ä¿å­˜å¸•ç´¯æ‰˜è§£
        for idx, sol in enumerate(pareto_solutions):
            biz_idx = original_indices.index(idx) if idx in original_indices else None
            if biz_idx is None:
                continue

            biz = business_data[biz_idx]

            solution = ParetoSolution(
                task_id=task_id,
                f1=sol['f1'],
                f2=sol['f2'],
                f3=sol.get('f3'),
                total_cost=biz[0],
                implementation_days=biz[1],
                expected_benefit=biz[2],
                solution_data=sol,
                technical_details=sol.get('individual', {})
            )
            session.add(solution)

        # 5. æ›´æ–°ä»»åŠ¡çŠ¶æ€
        task.status = TaskStatus.COMPLETED
        task.pareto_solution_count = len(pareto_solutions)
        task.completed_at = datetime.utcnow()
        task.progress = 100
        session.commit()

    except Exception as e:
        task.status = TaskStatus.FAILED
        session.commit()
        raise e

# ============ APIç«¯ç‚¹ ============

@router.post("/tasks")
async def create_optimization_task(
    request: OptimizationRequest,
    background_tasks: BackgroundTasks,
    session: Session = Depends(get_session)
):
    """åˆ›å»ºæ–°çš„ä¼˜åŒ–ä»»åŠ¡ (åå°æ‰§è¡Œ)"""

    # åˆ›å»ºä»»åŠ¡è®°å½•
    task = OptimizationTask(
        name=request.name,
        industry_type=request.industry_type,
        input_params=request.dict()
    )
    session.add(task)
    session.commit()
    session.refresh(task)

    # æ·»åŠ åå°ä»»åŠ¡
    background_tasks.add_task(run_optimization_task, str(task.id), session)

    return {
        "task_id": str(task.id),
        "name": task.name,
        "status": task.status,
        "progress": task.progress,
        "created_at": task.created_at
    }

@router.get("/tasks/{task_id}")
async def get_task_status(
    task_id: str,
    session: Session = Depends(get_session)
):
    """è·å–ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦"""
    task = session.get(OptimizationTask, task_id)
    if not task:
        raise HTTPException(status_code=404, detail="ä»»åŠ¡ä¸å­˜åœ¨")

    return {
        "task_id": str(task.id),
        "name": task.name,
        "status": task.status,
        "progress": task.progress,
        "solution_count": task.pareto_solution_count,
        "recommended_solution_id": str(task.recommended_solution_id) if task.recommended_solution_id else None,
        "created_at": task.created_at,
        "started_at": task.started_at,
        "completed_at": task.completed_at
    }

@router.get("/tasks/{task_id}/solutions")
async def get_pareto_solutions(
    task_id: str,
    limit: int = 20,
    session: Session = Depends(get_session)
):
    """è·å–å¸•ç´¯æ‰˜æœ€ä¼˜è§£åˆ—è¡¨"""
    statement = select(ParetoSolution).where(
        ParetoSolution.task_id == task_id
    ).limit(limit)
    solutions = session.exec(statement).all()

    return [
        {
            "id": str(s.id),
            "rank": s.rank,
            "f1": s.f1,
            "f2": s.f2,
            "f3": s.f3,
            "total_cost": s.total_cost,
            "implementation_days": s.implementation_days,
            "expected_benefit": s.expected_benefit,
            "topsis_score": s.topsis_score
        }
        for s in solutions
    ]

@router.post("/tasks/{task_id}/decide/ahp")
async def calculate_ahp_weights(
    task_id: str,
    matrix_01: float,
    matrix_02: float,
    matrix_12: float,
    session: Session = Depends(get_session)
):
    """è®¡ç®—AHPæƒé‡"""

    # æ„å»ºåˆ¤æ–­çŸ©é˜µ
    matrix = np.array([
        [1, matrix_01, matrix_02],
        [1/matrix_01, 1, matrix_12],
        [1/matrix_02, 1/matrix_12, 1]
    ])

    # è®¡ç®—æƒé‡
    weights = part2_decision.ahp_weight_calculation(matrix)

    if weights is None:
        raise HTTPException(status_code=400, detail="ä¸€è‡´æ€§æ£€éªŒå¤±è´¥")

    # ä¿å­˜å†³ç­–è®°å½•
    record = DecisionRecord(
        task_id=task_id,
        ahp_matrix={"matrix": matrix.tolist()},
        weights={
            "cost": float(weights[0]),
            "time": float(weights[1]),
            "benefit": float(weights[2])
        }
    )
    session.add(record)
    session.commit()

    return {
        "weights": {
            "cost": round(float(weights[0]), 4),
            "time": round(float(weights[1]), 4),
            "benefit": round(float(weights[2]), 4)
        }
    }

@router.post("/tasks/{task_id}/decide/topsis")
async def run_topsis_decision(
    task_id: str,
    weights: dict | None = None,
    session: Session = Depends(get_session)
):
    """è¿è¡ŒTOPSISç»¼åˆè¯„åˆ†"""

    # è·å–æ‰€æœ‰æ–¹æ¡ˆ
    statement = select(ParetoSolution).where(ParetoSolution.task_id == task_id)
    solutions = session.exec(statement).all()

    # æ„å»ºå†³ç­–çŸ©é˜µ
    decision_matrix = np.array([
        [s.total_cost, s.implementation_days, s.expected_benefit]
        for s in solutions
    ])

    # ä½¿ç”¨é»˜è®¤æƒé‡æˆ–ç”¨æˆ·æä¾›çš„æƒé‡
    if weights is None:
        weights_array = np.array([0.33, 0.33, 0.34])
    else:
        weights_array = np.array([
            weights.get('cost', 0.33),
            weights.get('time', 0.33),
            weights.get('benefit', 0.34)
        ])

    # è®¡ç®—TOPSISå¾—åˆ†
    scores = part2_decision.topsis_ranking(decision_matrix, weights_array)

    # æ›´æ–°æ–¹æ¡ˆæ’å
    for i, (solution, score) in enumerate(zip(solutions, scores)):
        solution.topsis_score = float(score)
        solution.rank = i + 1

    session.commit()

    best_idx = np.argmax(scores)

    return {
        "best_solution_id": str(solutions[best_idx].id),
        "scores": [
            {"solution_id": str(s.id), "score": round(float(sc), 4)}
            for s, sc in zip(solutions, scores)
        ]
    }
```

---

## ä¸‰ã€æ•°æ®åº“è¿ç§»

### 3.1 åˆ›å»ºè¿ç§»æ–‡ä»¶

```bash
cd backend
uv run alembic revision --autogenerate -m "Add tianchou optimization tables"
uv run alembic upgrade head
```

### 3.2 è¡¨ç»“æ„

- `optimization_tasks`: ä¼˜åŒ–ä»»åŠ¡è¡¨
- `pareto_solutions`: å¸•ç´¯æ‰˜è§£è¡¨
- `decision_records`: å†³ç­–è®°å½•è¡¨

---

## å››ã€å‰ç«¯è®¾è®¡

å‰ç«¯è®¾è®¡ä¿æŒä¸åŸæ–¹æ¡ˆä¸€è‡´ï¼Œä¸»è¦å˜åŒ–ï¼š

1. **è½®è¯¢æœºåˆ¶**: ç”±äºæ²¡æœ‰ WebSocketï¼Œä½¿ç”¨å®šæ—¶è½®è¯¢è·å–ä»»åŠ¡çŠ¶æ€
2. **è¿›åº¦æ˜¾ç¤º**: é€šè¿‡ `GET /tasks/{task_id}` è·å– progress å­—æ®µ

å¯è§†åŒ–æ¸²æŸ“:

- **æ–¹æ¡ˆ**: å‰ç«¯ä½¿ç”¨Recharts + D3.js
- **åŸå› **:
  - å¸•ç´¯æ‰˜å‰æ²¿å›¾ä½¿ç”¨Recharts Scatter Chart
  - å¸ƒå±€/è·¯å¾„å¯è§†åŒ–ä½¿ç”¨D3.js SVGæ¸²æŸ“
  - æ”¯æŒäº¤äº’å¼ç¼©æ”¾ã€æ‹–æ‹½
### 3.1 é¡µé¢ç»“æ„

```
frontend/src/pages/
â”œâ”€â”€ Tianchou.tsx                    # å¤©ç­¹ä¸»é¡µé¢
â”œâ”€â”€ Tianchou/
â”‚   â”œâ”€â”€ index.tsx                   # é¡µé¢å…¥å£
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ TaskConfigForm.tsx      # ä»»åŠ¡é…ç½®è¡¨å•
â”‚   â”‚   â”œâ”€â”€ TaskProgress.tsx        # ä»»åŠ¡è¿›åº¦æ¡
â”‚   â”‚   â”œâ”€â”€ ParetoFrontChart.tsx    # å¸•ç´¯æ‰˜å‰æ²¿å›¾
â”‚   â”‚   â”œâ”€â”€ SolutionCard.tsx        # æ–¹æ¡ˆå¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ SolutionDetailModal.tsx # æ–¹æ¡ˆè¯¦æƒ…å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ LayoutVisualizer.tsx    # å¸ƒå±€å¯è§†åŒ– (è½»å·¥ä¸š)
â”‚   â”‚   â”œâ”€â”€ AGVVisualizer.tsx       # AGVè·¯å¾„å¯è§†åŒ– (é‡å·¥ä¸š)
â”‚   â”‚   â”œâ”€â”€ AHPWizard.tsx           # AHPæƒé‡å‘å¯¼
â”‚   â”‚   â”œâ”€â”€ ComparisonTable.tsx     # æ–¹æ¡ˆå¯¹æ¯”è¡¨
â”‚   â”‚   â””â”€â”€ RecommendationPanel.tsx # æ¨èæ–¹æ¡ˆé¢æ¿
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useTianchou.ts          # å¤©ç­¹çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ useOptimization.ts      # ä¼˜åŒ–ä»»åŠ¡Hook
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ tianchouService.ts      # APIè°ƒç”¨æœåŠ¡
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ tianchou.ts             # ç±»å‹å®šä¹‰
```

### 3.2 ç±»å‹å®šä¹‰

```typescript
// frontend/src/pages/Tianchou/types/tianchou.ts

export enum IndustryType {
  LIGHT = 'light',
  HEAVY = 'heavy'
}

export enum TaskStatus {
  PENDING = 'pending',
  RUNNING = 'running',
  COMPLETED = 'completed',
  FAILED = 'failed'
}

export interface OptimizationTask {
  id: string;
  name: string;
  industry_type: IndustryType;
  status: TaskStatus;
  progress: number;
  pareto_solution_count: number;
  recommended_solution_id?: string;
  created_at: string;
  started_at?: string;
  completed_at?: string;
}

export interface ParetoSolution {
  id: string;
  rank: number;
  // æŠ€æœ¯æŒ‡æ ‡
  f1: number;
  f2: number;
  f3?: number;
  // å•†ä¸šæŒ‡æ ‡
  total_cost: number;
  implementation_days: number;
  expected_benefit: number;
  topsis_score?: number;
  // è¯¦æƒ…
  details: {
    moved_devices?: Array<{
      device_id: number;
      device_name: string;
      original_position: [number, number];
      new_position: [number, number];
      distance: number;
      cost: number;
    }>;
    agv_routes?: Array<{
      agv_id: number;
      route: Array<[number, number]>;
      completion_time: number;
    }>;
  };
}

export interface AHPWeights {
  cost: number;
  time: number;
  benefit: number;
}

export interface RepresentativeSolutions {
  min_cost: ParetoSolution;
  min_time: ParetoSolution;
  max_benefit: ParetoSolution;
  best_overall: ParetoSolution;
}
```

### 3.3 APIæœåŠ¡

```typescript
// frontend/src/pages/Tianchou/services/tianchouService.ts

import axios from 'axios';
import type { 
  OptimizationTask, 
  ParetoSolution, 
  AHPWeights,
  RepresentativeSolutions 
} from '../types';

const api = axios.create({
  baseURL: '/api/v1/tianchou',
});

export const tianchouService = {
  // åˆ›å»ºä¼˜åŒ–ä»»åŠ¡
  async createTask(params: {
    name: string;
    industry_type: string;
    // è½»å·¥ä¸šå‚æ•°
    workshop_length?: number;
    workshop_width?: number;
    device_count?: number;
    // é‡å·¥ä¸šå‚æ•°
    station_count?: number;
    agv_count?: number;
    // å•†ä¸šå‚æ•°
    daily_output_value?: number;
    base_cost?: number;
  }): Promise<OptimizationTask> {
    const { data } = await api.post('/tasks', params);
    return data;
  },
  
  // è·å–ä»»åŠ¡çŠ¶æ€
  async getTaskStatus(taskId: string): Promise<OptimizationTask> {
    const { data } = await api.get(`/tasks/${taskId}`);
    return data;
  },
  
  // è·å–å¸•ç´¯æ‰˜è§£åˆ—è¡¨
  async getSolutions(
    taskId: string, 
    limit = 20
  ): Promise<ParetoSolution[]> {
    const { data } = await api.get(`/tasks/${taskId}/solutions`, {
      params: { limit }
    });
    return data;
  },
  
  // è·å–æ–¹æ¡ˆè¯¦æƒ…
  async getSolutionDetail(taskId: string, solutionId: string): Promise<ParetoSolution> {
    const { data } = await api.get(`/tasks/${taskId}/solutions/${solutionId}`);
    return data;
  },
  
  // è®¡ç®—AHPæƒé‡
  async calculateAHP(
    taskId: string,
    matrix: { m01: number; m02: number; m12: number }
  ): Promise<{ weights: AHPWeights; consistency_ratio: number; is_valid: boolean }> {
    const { data } = await api.post(`/tasks/${taskId}/decide/ahp`, matrix);
    return data;
  },
  
  // è¿è¡ŒTOPSISè¯„åˆ†
  async runTOPSIS(
    taskId: string, 
    weights?: AHPWeights
  ): Promise<{ best_solution_id: string; scores: Array<{ solution_id: string; score: number }> }> {
    const { data } = await api.post(`/tasks/${taskId}/decide/topsis`, weights);
    return data;
  },
  
  // è·å–ä»»åŠ¡æ€»ç»“
  async getTaskSummary(taskId: string): Promise<{
    task: OptimizationTask;
    representative_solutions: RepresentativeSolutions;
  }> {
    const { data } = await api.get(`/tasks/${taskId}/summary`);
    return data;
  }
};
```

### 3.4 é¡µé¢å¸ƒå±€è®¾è®¡

```tsx
// frontend/src/pages/Tianchou/index.tsx

import React, { useState, useEffect, useCallback } from 'react';
import { useSearchParams } from 'react-router-dom';
import { TaskConfigForm } from './components/TaskConfigForm';
import { TaskProgress } from './components/TaskProgress';
import { ParetoFrontChart } from './components/ParetoFrontChart';
import { SolutionCard } from './components/SolutionCard';
import { AHPWizard } from './components/AHPWizard';
import { RecommendationPanel } from './components/RecommendationPanel';
import { LayoutVisualizer } from './components/LayoutVisualizer';
import { useTianchou } from './hooks/useTianchou';
import { tianchouService } from './services/tianchouService';
import { TaskStatus, type ParetoSolution } from './types';

const TianchouPage: React.FC = () => {
  const [searchParams] = useSearchParams();
  const {
    task,
    setTask,
    solutions,
    setSolutions,
    selectedSolution,
    setSelectedSolution,
    ahpWeights,
    setAhpWeights
  } = useTianchou();
  
  const [view, setView] = useState<'config' | 'optimizing' | 'results'>('config');
  const [showAHPWizard, setShowAHPWizard] = useState(false);
  
  // åˆ›å»ºä¼˜åŒ–ä»»åŠ¡
  const handleCreateTask = useCallback(async (params: any) => {
    try {
      const newTask = await tianchouService.createTask(params);
      setTask(newTask);
      setView('optimizing');
      
      // å¼€å§‹è½®è¯¢ä»»åŠ¡çŠ¶æ€
      pollTaskStatus(newTask.id);
    } catch (error) {
      console.error('åˆ›å»ºä»»åŠ¡å¤±è´¥:', error);
    }
  }, [setTask]);
  
  // è½®è¯¢ä»»åŠ¡çŠ¶æ€
  const pollTaskStatus = async (taskId: string) => {
    const poll = async () => {
      const status = await tianchouService.getTaskStatus(taskId);
      setTask(status);
      
      if (status.status === TaskStatus.RUNNING) {
        setTimeout(poll, 2000);
      } else if (status.status === TaskStatus.COMPLETED) {
        // åŠ è½½æ–¹æ¡ˆåˆ—è¡¨
        const sols = await tianchouService.getSolutions(taskId);
        setSolutions(sols);
        setView('results');
      } else if (status.status === TaskStatus.FAILED) {
        // å¤„ç†å¤±è´¥
        console.error('ä»»åŠ¡æ‰§è¡Œå¤±è´¥');
      }
    };
    poll();
  };
  
  // é€‰æ‹©æ–¹æ¡ˆæŸ¥çœ‹è¯¦æƒ…
  const handleSelectSolution = async (solution: ParetoSolution) => {
    const detail = await tianchouService.getSolutionDetail(task!.id, solution.id);
    setSelectedSolution(detail);
  };
  
  // è¿è¡ŒAHP-TOPSISå†³ç­–
  const handleRunDecision = async (weights: AHPWeights) => {
    setAhpWeights(weights);
    const result = await tianchouService.runTOPSIS(task!.id, weights);
    // æ›´æ–°æ–¹æ¡ˆæ’å
    // ...
  };
  
  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <header className="mb-6">
        <h1 className="text-3xl font-bold text-gray-900">å¤©ç­¹ä¼˜åŒ–å†³ç­–ç³»ç»Ÿ</h1>
        <p className="text-gray-600 mt-2">åŸºäºå¤šç›®æ ‡é—ä¼ ç®—æ³•çš„æ™ºèƒ½åˆ¶é€ ä¼˜åŒ–æ–¹æ¡ˆ</p>
      </header>
      
      <main className="max-w-7xl mx-auto">
        {/* é…ç½®é˜¶æ®µ */}
        {view === 'config' && (
          <TaskConfigForm onSubmit={handleCreateTask} />
        )}
        
        {/* ä¼˜åŒ–æ‰§è¡Œé˜¶æ®µ */}
        {view === 'optimizing' && task && (
          <TaskProgress 
            task={task} 
            onCancel={() => setView('config')}
          />
        )}
        
        {/* ç»“æœå±•ç¤ºé˜¶æ®µ */}
        {view === 'results' && task && (
          <div className="grid grid-cols-12 gap-6">
            {/* å·¦ä¾§ï¼šå¸•ç´¯æ‰˜å‰æ²¿å›¾ */}
            <div className="col-span-8">
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-xl font-semibold mb-4">å¸•ç´¯æ‰˜æœ€ä¼˜è§£é›†</h2>
                <ParetoFrontChart 
                  solutions={solutions}
                  onSelect={handleSelectSolution}
                  selectedId={selectedSolution?.id}
                />
              </div>
              
              {/* å¸ƒå±€å¯è§†åŒ– (è½»å·¥ä¸š) */}
              {task.industry_type === 'light' && selectedSolution && (
                <div className="mt-6 bg-white rounded-lg shadow p-6">
                  <h2 className="text-xl font-semibold mb-4">è½¦é—´å¸ƒå±€æ–¹æ¡ˆ</h2>
                  <LayoutVisualizer 
                    solution={selectedSolution}
                    originalLayout={/* åŸå§‹å¸ƒå±€æ•°æ® */}
                  />
                </div>
              )}
              
              {/* AGVè·¯å¾„å¯è§†åŒ– (é‡å·¥ä¸š) */}
              {task.industry_type === 'heavy' && selectedSolution && (
                <div className="mt-6 bg-white rounded-lg shadow p-6">
                  <h2 className="text-xl font-semibold mb-4">AGVè°ƒåº¦è·¯å¾„</h2>
                  <AGVVisualizer solution={selectedSolution} />
                </div>
              )}
            </div>
            
            {/* å³ä¾§ï¼šæ–¹æ¡ˆåˆ—è¡¨å’Œå†³ç­–é¢æ¿ */}
            <div className="col-span-4 space-y-6">
              {/* æ¨èé¢æ¿ */}
              <RecommendationPanel 
                task={task}
                solutions={solutions}
                onRunAHP={() => setShowAHPWizard(true)}
              />
              
              {/* æ–¹æ¡ˆåˆ—è¡¨ */}
              <div className="bg-white rounded-lg shadow p-6">
                <h2 className="text-xl font-semibold mb-4">å€™é€‰æ–¹æ¡ˆåˆ—è¡¨</h2>
                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {solutions.slice(0, 10).map(solution => (
                    <SolutionCard
                      key={solution.id}
                      solution={solution}
                      isSelected={selectedSolution?.id === solution.id}
                      onClick={() => handleSelectSolution(solution)}
                    />
                  ))}
                </div>
              </div>
            </div>
          </div>
        )}
      </main>
      
      {/* AHPå‘å¯¼å¼¹çª— */}
      {showAHPWizard && (
        <AHPWizard
          onComplete={handleRunDecision}
          onClose={() => setShowAHPWizard(false)}
        />
      )}
    </div>
  );
};

export default TianchouPage;
```

### 3.5 å…³é”®ç»„ä»¶è®¾è®¡

#### å¸•ç´¯æ‰˜å‰æ²¿å›¾

```tsx
// frontend/src/pages/Tianchou/components/ParetoFrontChart.tsx

import React, { useMemo } from 'react';
import {
  ScatterChart,
  Scatter,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend
} from 'recharts';
import type { ParetoSolution } from '../types';

interface Props {
  solutions: ParetoSolution[];
  onSelect: (solution: ParetoSolution) => void;
  selectedId?: string;
}

const ParetoFrontChart: React.FC<Props> = ({ solutions, onSelect, selectedId }) => {
  // å‡†å¤‡å›¾è¡¨æ•°æ®
  const chartData = useMemo(() => {
    return solutions.map((sol, index) => ({
      ...sol,
      x: sol.total_cost,
      y: sol.implementation_days,
      z: sol.expected_benefit,
      index: index + 1
    }));
  }, [solutions]);
  
  // æ¨èæ–¹æ¡ˆé«˜äº®
  const recommendedData = chartData.filter(s => s.topsis_score === Math.max(...solutions.map(s => s.topsis_score || 0)));
  const otherData = chartData.filter(s => s.topsis_score !== Math.max(...solutions.map(s => s.topsis_score || 0)));
  
  return (
    <ResponsiveContainer width="100%" height={400}>
      <ScatterChart>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis 
          type="number" 
          dataKey="x" 
          name="æ€»æˆæœ¬" 
          unit="å…ƒ"
          tickFormatter={(v) => `${(v/10000).toFixed(1)}ä¸‡`}
        />
        <YAxis 
          type="number" 
          dataKey="y" 
          name="å·¥æœŸ" 
          unit="å¤©"
        />
        <Tooltip
          formatter={(value: any, name: string) => {
            if (name === 'æ€»æˆæœ¬') return [`${value.toLocaleString()}å…ƒ`, name];
            if (name === 'å·¥æœŸ') return [`${value.toFixed(1)}å¤©`, name];
            return [value, name];
          }}
          labelFormatter={(label) => `æ–¹æ¡ˆ #${label}`}
          content={({ active, payload }) => {
            if (active && payload && payload.length) {
              const data = payload[0].payload;
              return (
                <div className="bg-white p-3 shadow-lg rounded-lg border">
                  <p className="font-semibold">æ–¹æ¡ˆ #{data.index}</p>
                  <p className="text-sm">æ€»æˆæœ¬: {data.total_cost.toLocaleString()}å…ƒ</p>
                  <p className="text-sm">å·¥æœŸ: {data.implementation_days.toFixed(1)}å¤©</p>
                  <p className="text-sm">é¢„æœŸæ”¶ç›Š: {data.expected_benefit.toLocaleString()}å…ƒ</p>
                  {data.topsis_score && (
                    <p className="text-sm font-medium text-blue-600">
                      TOPSISè¯„åˆ†: {data.topsis_score.toFixed(4)}
                    </p>
                  )}
                </div>
              );
            }
            return null;
          }}
        />
        <Legend />
        <Scatter 
          name="å€™é€‰æ–¹æ¡ˆ" 
          data={otherData} 
          fill="#3498db" 
          onClick={(data) => onSelect(data as unknown as ParetoSolution)}
          cursor="pointer"
        />
        <Scatter 
          name="æ¨èæ–¹æ¡ˆ" 
          data={recommendedData} 
          fill="#e74c3c" 
          shape="star"
          onClick={(data) => onSelect(data as unknown as ParetoSolution)}
        />
      </ScatterChart>
    </ResponsiveContainer>
  );
};

export default ParetoFrontChart;
```

#### AHPæƒé‡å‘å¯¼

```tsx
// frontend/src/pages/Tianchou/components/AHPWizard.tsx

import React, { useState } from 'react';
import { Modal } from '@/components/Modal';
import { tianchouService } from '../services/tianchouService';
import type { AHPWeights } from '../types';

interface Props {
  onComplete: (weights: AHPWeights) => void;
  onClose: () => void;
}

const AHPWizard: React.FC<Props> = ({ onComplete, onClose }) => {
  const [step, setStep] = useState(1);
  const [matrix, setMatrix] = useState({ m01: '1', m02: '1', m12: '1' });
  const [result, setResult] = useState<{ weights: AHPWeights; consistency_ratio: number; is_valid: boolean } | null>(null);
  const [loading, setLoading] = useState(false);
  
  // è§£æè¾“å…¥å€¼
  const parseValue = (v: string): number => {
    if (v.includes('/')) {
      const [a, b] = v.split('/');
      return parseFloat(a) / parseFloat(b);
    }
    return parseFloat(v);
  };
  
  // è®¡ç®—æƒé‡
  const handleCalculate = async () => {
    setLoading(true);
    try {
      const res = await tianchouService.calculateAHP('default-task', {
        m01: parseValue(matrix.m01),
        m02: parseValue(matrix.m02),
        m12: parseValue(matrix.m12)
      });
      setResult(res);
      setStep(3);
    } catch (error) {
      console.error('è®¡ç®—å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <Modal title="AHPæƒé‡è®¾å®šå‘å¯¼" onClose={onClose} size="lg">
      <div className="p-6">
        {/* æ­¥éª¤æŒ‡ç¤ºå™¨ */}
        <div className="flex items-center justify-center mb-8">
          {[1, 2, 3].map(s => (
            <React.Fragment key={s}>
              <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                step >= s ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-500'
              }`}>
                {s}
              </div>
              {s < 3 && <div className={`w-16 h-1 ${step > s ? 'bg-blue-600' : 'bg-gray-200'}`} />}
            </React.Fragment>
          ))}
        </div>
        
        {/* æ­¥éª¤1: è¯´æ˜ */}
        {step === 1 && (
          <div className="text-center">
            <h3 className="text-xl font-semibold mb-4">æ¬¢è¿ä½¿ç”¨AHPæƒé‡è®¾å®š</h3>
            <p className="text-gray-600 mb-6">
              å±‚æ¬¡åˆ†ææ³•(AHP)å¸®åŠ©æ‚¨é‡åŒ–å†³ç­–åå¥½ã€‚è¯·æ¯”è¾ƒä»¥ä¸‹ä¸‰è¦ç´ çš„é‡è¦æ€§ï¼š
            </p>
            <div className="grid grid-cols-3 gap-4 text-left bg-gray-50 p-4 rounded-lg">
              <div>
                <span className="font-medium">ğŸ’° æˆæœ¬</span>
                <p className="text-sm text-gray-500">æ–¹æ¡ˆçš„å®æ–½æ€»æˆæœ¬</p>
              </div>
              <div>
                <span className="font-medium">â±ï¸ å·¥æœŸ</span>
                <p className="text-sm text-gray-500">æ–¹æ¡ˆçš„å®æ–½å‘¨æœŸ</p>
              </div>
              <div>
                <span className="font-medium">ğŸ“ˆ æ”¶ç›Š</span>
                <p className="text-sm text-gray-500">æ–¹æ¡ˆçš„é¢„æœŸå¹´æ”¶ç›Š</p>
              </div>
            </div>
            <button 
              className="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg"
              onClick={() => setStep(2)}
            >
              å¼€å§‹è®¾å®š
            </button>
          </div>
        )}
        
        {/* æ­¥éª¤2: ä¸¤ä¸¤æ¯”è¾ƒ */}
        {step === 2 && (
          <div>
            <h3 className="text-xl font-semibold mb-6">è¯·è¿›è¡Œä¸¤ä¸¤æ¯”è¾ƒ</h3>
            
            <div className="space-y-6">
              {/* é—®é¢˜1: æˆæœ¬ vs å·¥æœŸ */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <p className="mb-3">
                  ç›¸æ¯”äº<span className="font-medium">å·¥æœŸ</span>ï¼Œ
                  <span className="font-medium">æˆæœ¬</span>æœ‰å¤šé‡è¦ï¼Ÿ
                </p>
                <div className="flex items-center gap-4">
                  <input
                    type="text"
                    value={matrix.m01}
                    onChange={(e) => setMatrix({ ...matrix, m01: e.target.value })}
                    className="flex-1 px-3 py-2 border rounded-lg"
                    placeholder="1-9 æˆ– åˆ†æ•°å¦‚ 1/3"
                  />
                  <select 
                    className="px-3 py-2 border rounded-lg"
                    onChange={(e) => setMatrix({ ...matrix, m01: e.target.value })}
                  >
                    <option value="1">åŒç­‰é‡è¦ (1)</option>
                    <option value="3">ç¨å¾®é‡è¦ (3)</option>
                    <option value="5">æ˜æ˜¾é‡è¦ (5)</option>
                    <option value="7">éå¸¸é‡è¦ (7)</option>
                    <option value="9">æç«¯é‡è¦ (9)</option>
                    <option value="1/3">ç¨å¾®ä¸é‡è¦ (1/3)</option>
                    <option value="1/5">æ˜æ˜¾ä¸é‡è¦ (1/5)</option>
                  </select>
                </div>
              </div>
              
              {/* é—®é¢˜2: æˆæœ¬ vs æ”¶ç›Š */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <p className="mb-3">
                  ç›¸æ¯”äº<span className="font-medium">æ”¶ç›Š</span>ï¼Œ
                  <span className="font-medium">æˆæœ¬</span>æœ‰å¤šé‡è¦ï¼Ÿ
                </p>
                <div className="flex items-center gap-4">
                  <input
                    type="text"
                    value={matrix.m02}
                    onChange={(e) => setMatrix({ ...matrix, m02: e.target.value })}
                    className="flex-1 px-3 py-2 border rounded-lg"
                  />
                  <select 
                    className="px-3 py-2 border rounded-lg"
                    onChange={(e) => setMatrix({ ...matrix, m02: e.target.value })}
                  >
                    <option value="1">åŒç­‰é‡è¦ (1)</option>
                    <option value="3">ç¨å¾®é‡è¦ (3)</option>
                    <option value="5">æ˜æ˜¾é‡è¦ (5)</option>
                  </select>
                </div>
              </div>
              
              {/* é—®é¢˜3: å·¥æœŸ vs æ”¶ç›Š */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <p className="mb-3">
                  ç›¸æ¯”äº<span className="font-medium">æ”¶ç›Š</span>ï¼Œ
                  <span className="font-medium">å·¥æœŸ</span>æœ‰å¤šé‡è¦ï¼Ÿ
                </p>
                <div className="flex items-center gap-4">
                  <input
                    type="text"
                    value={matrix.m12}
                    onChange={(e) => setMatrix({ ...matrix, m12: e.target.value })}
                    className="flex-1 px-3 py-2 border rounded-lg"
                  />
                  <select 
                    className="px-3 py-2 border rounded-lg"
                    onChange={(e) => setMatrix({ ...matrix, m12: e.target.value })}
                  >
                    <option value="1">åŒç­‰é‡è¦ (1)</option>
                    <option value="3">ç¨å¾®é‡è¦ (3)</option>
                    <option value="5">æ˜æ˜¾é‡è¦ (5)</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div className="flex justify-between mt-6">
              <button 
                className="px-4 py-2 border rounded-lg"
                onClick={() => setStep(1)}
              >
                ä¸Šä¸€æ­¥
              </button>
              <button 
                className="px-6 py-2 bg-blue-600 text-white rounded-lg"
                onClick={handleCalculate}
                disabled={loading}
              >
                {loading ? 'è®¡ç®—ä¸­...' : 'è®¡ç®—æƒé‡'}
              </button>
            </div>
          </div>
        )}
        
        {/* æ­¥éª¤3: ç»“æœ */}
        {step === 3 && result && (
          <div>
            <h3 className="text-xl font-semibold mb-6">è®¡ç®—ç»“æœ</h3>
            
            <div className="text-center mb-6">
              <p className="text-gray-600 mb-2">ä¸€è‡´æ€§æ¯”ç‡ (CR)</p>
              <p className={`text-2xl font-bold ${result.is_valid ? 'text-green-600' : 'text-red-600'}`}>
                {result.consistency_ratio.toFixed(4)}
              </p>
              <p className={`text-sm ${result.is_valid ? 'text-green-600' : 'text-red-600'}`}>
                {result.is_valid ? 'âœ… ä¸€è‡´æ€§æ£€éªŒé€šè¿‡' : 'âŒ ä¸€è‡´æ€§æ£€éªŒå¤±è´¥ï¼Œè¯·é‡æ–°è®¾å®š'}
              </p>
            </div>
            
            {result.is_valid && (
              <>
                <div className="bg-gray-50 p-4 rounded-lg mb-6">
                  <p className="font-medium mb-3">æœ€ç»ˆæƒé‡åˆ†é…ï¼š</p>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <span className="w-20">ğŸ’° æˆæœ¬</span>
                      <div className="flex-1 h-4 bg-gray-200 rounded overflow-hidden">
                        <div 
                          className="h-full bg-blue-600"
                          style={{ width: `${result.weights.cost * 100}%` }}
                        />
                      </div>
                      <span className="w-16 text-right">{(result.weights.cost * 100).toFixed(1)}%</span>
                    </div>
                    <div className="flex items-center">
                      <span className="w-20">â±ï¸ å·¥æœŸ</span>
                      <div className="flex-1 h-4 bg-gray-200 rounded overflow-hidden">
                        <div 
                          className="h-full bg-green-600"
                          style={{ width: `${result.weights.time * 100}%` }}
                        />
                      </div>
                      <span className="w-16 text-right">{(result.weights.time * 100).toFixed(1)}%</span>
                    </div>
                    <div className="flex items-center">
                      <span className="w-20">ğŸ“ˆ æ”¶ç›Š</span>
                      <div className="flex-1 h-4 bg-gray-200 rounded overflow-hidden">
                        <div 
                          className="h-full bg-purple-600"
                          style={{ width: `${result.weights.benefit * 100}%` }}
                        />
                      </div>
                      <span className="w-16 text-right">{(result.weights.benefit * 100).toFixed(1)}%</span>
                    </div>
                  </div>
                </div>
                
                <div className="flex justify-end gap-4">
                  <button 
                    className="px-4 py-2 border rounded-lg"
                    onClick={() => setStep(2)}
                  >
                    é‡æ–°è®¾å®š
                  </button>
                  <button 
                    className="px-6 py-2 bg-blue-600 text-white rounded-lg"
                    onClick={() => onComplete(result.weights)}
                  >
                    åº”ç”¨æƒé‡å¹¶å†³ç­–
                  </button>
                </div>
              </>
            )}
          </div>
        )}
      </div>
    </Modal>
  );
};

export default AHPWizard;
```

---

## æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å‰ç«¯ (React)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç”¨æˆ·å¡«å†™é…ç½®è¡¨å•                                                          â”‚
â”‚     â†“                                                                        â”‚
â”‚  2. POST /api/v1/tianchou/tasks â†’ è¿”å› task_id                               â”‚
â”‚     â†“                                                                        â”‚
â”‚  3. è½®è¯¢ GET /api/v1/tianchou/tasks/{task_id}                                â”‚
â”‚     â†“                                                                        â”‚
â”‚  4. çŠ¶æ€å˜ä¸º COMPLETED â†’ è·å–æ–¹æ¡ˆåˆ—è¡¨                                          â”‚
â”‚     â†“                                                                        â”‚
â”‚  5. GET /api/v1/tianchou/tasks/{task_id}/solutions                           â”‚
â”‚     â†“                                                                        â”‚
â”‚  6. ç”¨æˆ·æŸ¥çœ‹å¸•ç´¯æ‰˜å›¾ã€é€‰æ‹©æ–¹æ¡ˆæŸ¥çœ‹è¯¦æƒ…                                          â”‚
â”‚     â†“                                                                        â”‚
â”‚  7. ç”¨æˆ·å¯åŠ¨AHP-TOPSISå†³ç­–                                                   â”‚
â”‚     â†“                                                                        â”‚
â”‚  8. POST /api/v1/tianchou/tasks/{task_id}/decide/ahp â†’ è·å–æƒé‡                â”‚
â”‚     â†“                                                                        â”‚
â”‚  9. POST /api/v1/tianchou/tasks/{task_id}/decide/topsis â†’ è·å–è¯„åˆ†             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åç«¯ (FastAPI + Celery)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  APIå±‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ POST /tasks          â†’ åˆ›å»ºä»»åŠ¡, è§¦å‘Celeryå¼‚æ­¥ä»»åŠ¡                       â”‚â”‚
â”‚  â”‚ GET /tasks/{id}      â†’ è¿”å›ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦                                  â”‚â”‚
â”‚  â”‚ GET /tasks/{id}/solutions â†’ è¿”å›å¸•ç´¯æ‰˜è§£åˆ—è¡¨                              â”‚â”‚
â”‚  â”‚ POST /decide/ahp     â†’ è®¡ç®—AHPæƒé‡                                        â”‚â”‚
â”‚  â”‚ POST /decide/topsis  â†’ è®¡ç®—TOPSISè¯„åˆ†                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â†“                                        â”‚
â”‚  ä»»åŠ¡å±‚ (Celery)                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ run_optimization_task()                                                  â”‚â”‚
â”‚  â”‚   â”œâ”€ Part1: æŠ€æœ¯ä¼˜åŒ– (NSGA-II)                                           â”‚â”‚
â”‚  â”‚   â”‚     â”œâ”€ SLP_GA_Optimizer (è½»å·¥ä¸š)                                     â”‚â”‚
â”‚  â”‚   â”‚     â””â”€ AGVScheduler (é‡å·¥ä¸š)                                         â”‚â”‚
â”‚  â”‚   â”œâ”€ Part2: å•†ä¸šæ˜ å°„ (SchemeTranslator)                                  â”‚â”‚
â”‚  â”‚   â””â”€ Part3: å†³ç­–åˆ†æ (AHPTOPSISAnalyzer)                                 â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚  æ›´æ–°è¿›åº¦ â†’ å­˜å‚¨ç»“æœ â†’ å‘é€é€šçŸ¥                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â†“                                        â”‚
â”‚  ç®—æ³•å±‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ algorithms/                                                              â”‚â”‚
â”‚  â”‚   â”œâ”€ slp_ga_optimizer.py     (è½»å·¥ä¸šå¸ƒå±€ä¼˜åŒ–)                             â”‚â”‚
â”‚  â”‚   â”œâ”€ agv_scheduler.py        (é‡å·¥ä¸šAGVè°ƒåº¦)                             â”‚â”‚
â”‚  â”‚   â”œâ”€ scheme_translator.py    (æŠ€æœ¯â†’å•†ä¸šä»·å€¼è½¬æ¢)                          â”‚â”‚
â”‚  â”‚   â”œâ”€ ahp_topsis.py           (AHP-TOPSISå†³ç­–)                            â”‚â”‚
â”‚  â”‚   â””â”€ visualizer.py           (å¯è§†åŒ–å·¥å…·)                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ•°æ®åº“ (PostgreSQL)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  optimization_tasks (ä»»åŠ¡è¡¨)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ id, name, industry_type, input_params, status, progress,                â”‚â”‚
â”‚  â”‚ pareto_solution_count, recommended_solution_id,                         â”‚â”‚
â”‚  â”‚ weights_cost, weights_time, weights_benefit,                            â”‚â”‚
â”‚  â”‚ created_at, started_at, completed_at                                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  pareto_solutions (æ–¹æ¡ˆè¡¨)                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ id, task_id, f1, f2, f3, total_cost, implementation_days,               â”‚â”‚
â”‚  â”‚ expected_benefit, solution_data, technical_details,                     â”‚â”‚
â”‚  â”‚ rank, topsis_score                                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  decision_records (å†³ç­–è®°å½•è¡¨)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ id, task_id, ahp_matrix, weights, consistency_ratio,                    â”‚â”‚
â”‚  â”‚ best_solution_id, decision_scores, created_at                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---

## äº”ã€å®æ–½æ­¥éª¤

### Phase 1: ç®—æ³•æ¨¡å—è¿ç§» (1å¤©)

1. ä» test6 å¤åˆ¶æ ¸å¿ƒç®—æ³•ä»£ç åˆ° `backend/app/algorithms/`
2. è°ƒæ•´å¯¼å…¥è·¯å¾„å’Œä¾èµ–
3. æµ‹è¯•ç®—æ³•æ¨¡å—ç‹¬ç«‹è¿è¡Œ

### Phase 2: æ•°æ®åº“å’Œæ¨¡å‹ (0.5å¤©)

1. åœ¨ `models.py` ä¸­æ·»åŠ å¤©ç­¹ç›¸å…³æ¨¡å‹
2. åˆ›å»ºå¹¶æ‰§è¡Œæ•°æ®åº“è¿ç§»
3. éªŒè¯è¡¨ç»“æ„

### Phase 3: APIå®ç° (1å¤©)

1. å®ç° `tianchou.py` è·¯ç”±
2. å®ç°åå°ä»»åŠ¡å‡½æ•°
3. æµ‹è¯• API ç«¯ç‚¹

### Phase 4: å‰ç«¯é›†æˆ (2-3å¤©)

1. åˆ›å»ºå¤©ç­¹é¡µé¢ç»„ä»¶
2. å®ç°ä»»åŠ¡é…ç½®è¡¨å•
3. å®ç°ç»“æœå±•ç¤ºå’Œå¯è§†åŒ–
4. å®ç° AHP-TOPSIS äº¤äº’

---

## å…­ã€å…³é”®å·®å¼‚è¯´æ˜

| åŠŸèƒ½ | åŸæ–¹æ¡ˆ (Celery) | ç®€åŒ–æ–¹æ¡ˆ (BackgroundTasks) |
|------|----------------|---------------------------|
| ä»»åŠ¡æ‰§è¡Œ | Celery Worker | FastAPI BackgroundTasks |
| ä»»åŠ¡é˜Ÿåˆ— | Redis | å†…å­˜é˜Ÿåˆ— |
| è¿›åº¦é€šçŸ¥ | WebSocket/è½®è¯¢ | è½®è¯¢ |
| å¹¶å‘å¤„ç† | å¤šWorker | å•è¿›ç¨‹åå°çº¿ç¨‹ |
| é€‚ç”¨åœºæ™¯ | é«˜å¹¶å‘ã€å¤§è§„æ¨¡ | å°è§„æ¨¡ã€ä½å¹¶å‘ |

**ä¼˜ç‚¹:**
- éƒ¨ç½²ç®€å•ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- ä»£ç ç»“æ„æ¸…æ™°
- é€‚åˆç”¨æˆ·é‡å°‘çš„åœºæ™¯

**ç¼ºç‚¹:**
- æ— æ³•æ°´å¹³æ‰©å±•
- æœåŠ¡é‡å¯ä¼šä¸¢å¤±è¿è¡Œä¸­çš„ä»»åŠ¡
- ä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

---

*æ–‡æ¡£ç‰ˆæœ¬: 2.0 (ç®€åŒ–ç‰ˆ)*
*åˆ›å»ºæ—¥æœŸ: 2026-02-12*
*é¡¹ç›®: å¤©å·¥Â·å¼ˆæ§ - å¤©ç­¹ä¼˜åŒ–å†³ç­–ç³»ç»Ÿ*
