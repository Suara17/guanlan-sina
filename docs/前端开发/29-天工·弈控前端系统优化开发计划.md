天工·弈控前端系统优化开发计划                      
                                                                                                                                                📊 现状评估总结
                                                                                                                                                已有资源
                                                                                                                                              
  - ✅ 技术栈: React 19 + TypeScript 5.8 + Tailwind CSS + Recharts   
  - ✅ 现有页面: Dashboard.tsx, Tianchou.tsx, Huntian.tsx 已实现基础功能
  - ✅ 组件库: Sidebar, TopBar, SinanAvatar, LandingPage, LoginPage 等核心组件完备
  - ✅ 路由系统: React Router v6 配置完整，支持 MemoryRouter
  - ✅ 样式系统: 已定义动画效果（旋转、浮动、脉冲等）
  - ✅ 类型定义: types.ts 包含基础类型，需扩展

  缺失功能（需开发）

  - ❌ 格物图谱页面: 完全不存在，需新建
  - ❌ Dashboard增强: 缺少产线选择器、数据看板、动态异常列表
  - ❌ 天筹优化: 需调整为接收格物图谱数据，去除权重设置
  - ❌ 浑天仿真: 需增加设备重排/线路优化动画
  - ❌ 页面间数据传递: 缺少跨页面数据流转机制

  ---
  🎯 详细开发任务清单

  阶段一：基础设施与类型定义（预计1天）

  任务 1.1：扩展类型定义

  文件: frontend/types.ts

  新增类型:
  // 产线类型
  export interface ProductionLine {
    id: string
    name: string // 例如: "SMT智能产线A01"
    type: 'SMT' | 'PCB' | '3C'
    status: 'running' | 'idle' | 'error'
  }

  // Dashboard 数据看板
  export interface DashboardMetrics {
    completionRate: number // 当日计划完成率
    actualProduction: number // 实际生产数
    plannedProduction: number // 计划生产数
    attendance: number // 出勤人数
    efficiency: number // 工时效率
    outputValue: number // 产值（单位：万元）
  }

  // 异常信息扩展
  export interface AnomalyDetail extends AlertItem {
    lineType: 'SMT' | 'PCB' | '3C' // 所属产线类型
    description: string // 详细描述
    rootCause?: string // 根本原因
    solutions?: string[] // 可能解决方案
  }

  // 知识图谱节点
  export interface KnowledgeNode {
    id: string
    type: 'phenomenon' | 'cause' | 'solution'
    label: string
    description: string
    x?: number // D3布局计算后的坐标
    y?: number
  }

  // 知识图谱关系
  export interface KnowledgeEdge {
    id: string
    source: string // 节点ID
    target: string // 节点ID
    type: 'leads_to' | 'caused_by' | 'solved_by'
    label?: string
  }

  // 知识图谱完整数据
  export interface KnowledgeGraph {
    nodes: KnowledgeNode[]
    edges: KnowledgeEdge[]
    anomalyId: string // 关联的异常ID
  }

  // 天筹决策结果
  export interface OptimizationResult {
    anomalyId: string
    phenomenon: string // 现象描述
    rootCauses: string[] // 原因列表
    solutions: SolutionOption[] // 解决方案
    estimatedRepairTime: { min: number; max: number } // 预计维修时长（分钟）
    successRate: number // 修复成功概率 (0-100)
    continuousProductionRisk: number // 继续生产的流出风险 (0-100)
    shutdownImpact: { delay: number; unit: 'hour' | 'day' } // 停线对交付影响
    remedialActions?: string[] // 补救方案
  }

  // 浑天仿真配置
  export interface SimulationConfig {
    type: 'device_rearrangement' | 'route_optimization' // 仿真类型
    duration: number // 仿真时长（小时）
    speed: 1 | 10 | 100 // 播放倍速
  }

  // 设备重排动画数据
  export interface DeviceMove {
    deviceId: string
    fromPosition: { x: number; y: number }
    toPosition: { x: number; y: number }
    duration: number // 动画持续时间（毫秒）
  }

  // 线路优化动画数据
  export interface RouteOptimization {
    routeId: string
    oldPath: { x: number; y: number }[]
    newPath: { x: number; y: number }[]
    duration: number
  }

  验收标准:
  - 类型文件无TypeScript编译错误
  - 所有导出类型被IDE正确识别

  ---
  阶段二：Mock数据准备（预计0.5天）

  任务 2.1：创建 Mock 数据文件

  文件: frontend/mockData.ts

  内容:
  import type { ProductionLine, DashboardMetrics, AnomalyDetail, KnowledgeGraph } from './types'

  // 9条产线
  export const PRODUCTION_LINES: ProductionLine[] = [
    { id: 'smt-a01', name: 'SMT智能产线A01', type: 'SMT', status: 'running' },
    { id: 'smt-a02', name: 'SMT智能产线A02', type: 'SMT', status: 'running' },
    { id: 'smt-a03', name: 'SMT智能产线A03', type: 'SMT', status: 'error' },
    { id: 'pcb-b01', name: 'PCB智能产线B01', type: 'PCB', status: 'running' },
    { id: 'pcb-b02', name: 'PCB智能产线B02', type: 'PCB', status: 'idle' },
    { id: 'pcb-b03', name: 'PCB智能产线B03', type: 'PCB', status: 'running' },
    { id: '3c-c01', name: '3C智能产线C01', type: '3C', status: 'running' },
    { id: '3c-c02', name: '3C智能产线C02', type: '3C', status: 'running' },
    { id: '3c-c03', name: '3C智能产线C03', type: '3C', status: 'error' },
  ]

  // SMT产线异常
  export const SMT_ANOMALIES: AnomalyDetail[] = [
    {
      id: 'smt-001',
      time: '14:32',
      level: 'critical',
      location: 'SMT贴片机#3',
      message: '吸嘴漏气，连续3次检测失败',
      lineType: 'SMT',
      description: 'SMT贴片机#3吸嘴漏气，连续3次检测失败',
      rootCause: '吸嘴密封圈老化',
      solutions: ['更换密封圈', '调整吸嘴压力', '校准真空泵']
    },
    // ... 其他5个SMT异常
  ]

  // PCB产线异常
  export const PCB_ANOMALIES: AnomalyDetail[] = [...]

  // 3C产线异常
  export const THREE_C_ANOMALIES: AnomalyDetail[] = [...]

  // 知识图谱数据（示例：SMT贴片机吸嘴漏气）
  export const KNOWLEDGE_GRAPH_SMT_001: KnowledgeGraph = {
    anomalyId: 'smt-001',
    nodes: [
      { id: 'n1', type: 'phenomenon', label: '异常现象', description: 'SMT贴片机#3吸嘴漏气' },
      { id: 'n2', type: 'cause', label: '直接原因', description: '真空压力不足' },
      { id: 'n3', type: 'cause', label: '根本原因1', description: '吸嘴密封圈老化' },
      { id: 'n4', type: 'cause', label: '根本原因2', description: '真空泵功率下降' },
      { id: 'n5', type: 'solution', label: '解决方案1', description: '更换密封圈（5分钟）' },
      { id: 'n6', type: 'solution', label: '解决方案2', description: '校准真空泵（15分钟）' },
      { id: 'n7', type: 'solution', label: '解决方案3', description: '更换真空泵（120分钟）' },
    ],
    edges: [
      { id: 'e1', source: 'n1', target: 'n2', type: 'leads_to' },
      { id: 'e2', source: 'n2', target: 'n3', type: 'caused_by' },
      { id: 'e3', source: 'n2', target: 'n4', type: 'caused_by' },
      { id: 'e4', source: 'n3', target: 'n5', type: 'solved_by' },
      { id: 'e5', source: 'n4', target: 'n6', type: 'solved_by' },
      { id: 'e6', source: 'n4', target: 'n7', type: 'solved_by' },
    ]
  }

  验收标准:
  - Mock数据覆盖9条产线
  - 每种产线类型至少6个异常
  - 至少3个完整知识图谱数据

  ---
  阶段三：Dashboard页面增强（预计1.5天）

  任务 3.1：创建产线选择器组件

  文件: frontend/components/ProductionLineSelector.tsx

  功能:
  - 左上角下拉框，显示9条产线
  - 高亮当前选中产线
  - 显示产线状态图标（运行中/空闲/异常）

  代码结构:
  interface Props {
    lines: ProductionLine[]
    selectedLine: ProductionLine | null
    onSelect: (line: ProductionLine) => void
  }

  任务 3.2：创建数据看板组件

  文件: frontend/components/DataDashboard.tsx

  功能:
  - 显示6个指标卡片：
    - 当日计划完成率（百分比 + 进度条）
    - 实际生产/计划生产（数字对比）
    - 出勤人数（人员图标 + 数字）
    - 工时效率（百分比）
    - 产值（万元）
    - OEE（设备综合效率）

  布局: Grid 2x3 或 3x2

  任务 3.3：修改异常列表组件

  文件: frontend/components/AnomalyList.tsx

  功能:
  - 接收 lineType 参数，根据产线类型过滤异常
  - 点击异常项跳转到格物图谱页面，传递异常ID

  代码逻辑:
  const navigate = useNavigate()
  const handleAnomalyClick = (anomalyId: string) => {
    navigate(`/app/gewu?anomalyId=${anomalyId}`)
  }

  任务 3.4：整合Dashboard页面

  文件: frontend/pages/Dashboard.tsx

  修改内容:
  1. 添加产线选择器到顶部
  2. 左侧添加数据看板
  3. 右侧异常列表根据选中产线动态更新
  4. 保留原有图表（生产监控、质量看板）

  验收标准:
  - 产线选择器正常工作，切换产线
  - 数据看板显示6个指标，数据Mock正确
  - 异常列表根据产线类型动态切换（SMT/PCB/3C）
  - 点击异常可跳转到格物图谱页面

  ---
  阶段四：格物图谱页面开发（预计2天）

  任务 4.1：安装D3.js依赖

  命令:
  cd frontend
  npm install d3 @types/d3

  任务 4.2：创建知识图谱画布组件

  文件: frontend/components/KnowledgeGraphCanvas.tsx

  功能:
  - 使用 D3.js 的 forceSimulation 实现力导向图布局
  - 节点类型：现象（红色圆形）、原因（橙色菱形）、解决方案（绿色矩形）
  - 边：带箭头的曲线，显示关系类型标签
  - 支持节点hover显示详细描述
  - 支持节点点击高亮关联路径

  核心代码:
  import * as d3 from 'd3'

  const simulation = d3.forceSimulation(nodes)
    .force('link', d3.forceLink(edges).id(d => d.id).distance(150))
    .force('charge', d3.forceManyBody().strength(-400))
    .force('center', d3.forceCenter(width / 2, height / 2))

  任务 4.3：创建节点详情面板

  文件: frontend/components/NodeDetailPanel.tsx

  功能:
  - 右侧面板，显示选中节点的详细信息
  - 现象节点：显示异常描述
  - 原因节点：显示根本原因分析
  - 解决方案节点：显示方案详情、预计时长、成功率

  任务 4.4：创建格物图谱页面

  文件: frontend/pages/KnowledgeGraph.tsx

  布局:
  - 顶部：面包屑导航（Dashboard → 格物图谱 → 异常详情）
  - 中央：图谱画布（占80%）
  - 右侧：节点详情面板（占20%）
  - 底部：操作按钮
    - "返回Dashboard"
    - "生成优化方案"（跳转到天筹页面）

  数据获取:
  const { search } = useLocation()
  const params = new URLSearchParams(search)
  const anomalyId = params.get('anomalyId')
  const graphData = getKnowledgeGraphByAnomalyId(anomalyId) // 从Mock数据获取

  任务 4.5：添加路由配置

  文件: frontend/App.tsx

  修改:
  import KnowledgeGraph from './pages/KnowledgeGraph'

  // 在Routes中添加
  <Route path="/gewu" element={<KnowledgeGraph />} />

  验收标准:
  - D3.js力导向图正常渲染
  - 节点颜色/形状根据类型正确显示
  - 边显示关系标签和箭头方向
  - 点击节点显示详情面板
  - 点击"生成优化方案"跳转到天筹页面并传递数据

  ---
  阶段五：天筹优化页面调整（预计1天）

  任务 5.1：修改数据接收逻辑

  文件: frontend/pages/Tianchou.tsx

  修改内容:
  1. 从URL参数或路由state接收格物图谱数据
  2. 移除左侧的"多目标优化权重"滑块
  3. 添加"异常信息"卡片（显示现象、原因）
  4. 添加"解决方案列表"（从格物图谱传递）

  新增UI:
  // 左侧面板新增
  <div className="bg-blue-50 p-4 rounded-xl">
    <h3 className="font-bold text-sm mb-2">异常现象</h3>
    <p className="text-xs">{anomalyData.phenomenon}</p>
  </div>

  <div className="bg-orange-50 p-4 rounded-xl">
    <h3 className="font-bold text-sm mb-2">根本原因</h3>
    <ul className="text-xs space-y-1">
      {anomalyData.rootCauses.map(cause => <li key={cause}>• {cause}</li>)}
    </ul>
  </div>

  任务 5.2：调整决策计算结果展示

  文件: frontend/pages/Tianchou.tsx

  修改右侧结果区域:
  - 去掉"瓶颈漂移监测"图表
  - 改为显示：
    - 预计维修时长: 15-30 分钟（区间显示）
    - 修复成功概率: 85%（进度条）
    - 继续生产的流出风险: 12%（对应可能损失：¥5,200）
    - 停线对交付影响: 延迟 2 小时（可选补救方案：加班补产）

  代码示例:
  <div className="grid grid-cols-2 gap-4">
    <MetricCard
      icon={<Clock />}
      label="预计维修时长"
      value="15-30 分钟"
      color="blue"
    />
    <MetricCard
      icon={<CheckCircle />}
      label="修复成功概率"
      value="85%"
      progress={85}
      color="green"
    />
    {/* ... 其他指标 */}
  </div>

  任务 5.3：更新跳转逻辑

  修改:
  - "去仿真验证"按钮传递决策结果数据到浑天页面

  验收标准:
  - 页面能接收格物图谱传递的异常数据
  - 左侧显示异常现象和根本原因
  - 点击"启动决策计算"后显示4个关键指标
  - 点击"去仿真验证"跳转到浑天并传递数据

  ---
  阶段六：浑天仿真页面增强（预计1.5天）

  任务 6.1：安装Framer Motion（可选）

  命令:
  npm install framer-motion

  任务 6.2：添加设备重排动画

  文件: frontend/pages/Huntian.tsx

  功能:
  - 在数字孪生画布中增加"设备重排"模式
  - 动画演示：2个设备方框交换位置
  - 使用CSS Transform或Framer Motion实现平滑过渡

  代码示例:
  const [devicePositions, setDevicePositions] = useState({
    device1: { x: 100, y: 100 },
    device2: { x: 300, y: 100 }
  })

  const handleRearrangement = () => {
    setDevicePositions({
      device1: { x: 300, y: 100 },
      device2: { x: 100, y: 100 }
    })
  }

  // 渲染
  <motion.div
    animate={devicePositions.device1}
    transition={{ duration: 2, ease: "easeInOut" }}
    className="absolute w-16 h-16 bg-blue-500 rounded-lg"
  />

  任务 6.3：添加线路优化动画

  文件: frontend/pages/Huntian.tsx

  功能:
  - 在画布中绘制AGV路径（SVG路径或Canvas）
  - 动画演示：路径从旧路径变形到新路径
  - 使用虚线箭头表示优化后的路径

  代码示例:
  <svg className="absolute inset-0 pointer-events-none">
    <motion.path
      d={isOptimized ? newPath : oldPath}
      stroke="#3b82f6"
      strokeWidth="3"
      fill="none"
      strokeDasharray="5,5"
      initial={{ pathLength: 0 }}
      animate={{ pathLength: 1 }}
      transition={{ duration: 2 }}
    />
  </svg>

  任务 6.4：添加仿真模式选择

  修改顶部工具栏:
  <div className="flex gap-2">
    <button onClick={() => setMode('device')}>设备重排</button>
    <button onClick={() => setMode('route')}>线路优化</button>
  </div>

  验收标准:
  - 设备重排动画流畅播放（2秒过渡）
  - 线路优化动画正确显示路径变化
  - 仿真模式切换正常工作
  - 动画结束后显示ROI报告

  ---
  阶段七：页面间数据传递与测试（预计1天）

  任务 7.1：实现数据传递机制

  方案: 使用 React Router 的 state 传递数据

  示例:
  // Dashboard → 格物图谱
  navigate('/app/gewu', { state: { anomalyId: 'smt-001' } })

  // 格物图谱 → 天筹
  navigate('/app/tianchou', {
    state: {
      anomaly: anomalyData,
      knowledgeGraph: graphData
    }
  })

  // 天筹 → 浑天
  navigate('/app/huntian', {
    state: {
      optimizationResult: resultData
    }
  })

  任务 7.2：端到端测试

  测试流程:
  1. 在Dashboard选择"SMT智能产线A03"
  2. 点击异常"SMT贴片机#3吸嘴漏气"
  3. 跳转到格物图谱，查看现象-原因-方案链路
  4. 点击"生成优化方案"跳转到天筹
  5. 天筹显示维修时长、成功率等指标
  6. 点击"去仿真验证"跳转到浑天
  7. 浑天播放设备重排或线路优化动画
  8. 查看ROI报告

  验收标准:
  - 完整流程无卡顿或数据丢失
  - 每个页面正确接收上游传递的数据
  - 所有导航按钮正常工作

  ---
  阶段八：样式优化与细节打磨（预计0.5天）

  任务 8.1：统一设计语言

  - 确保所有新组件使用Tailwind CSS
  - 保持与现有页面（Dashboard、Tianchou、Huntian）的视觉风格一致
  - 使用相同的颜色方案（蓝色主色调、红色警告、绿色成功）

  任务 8.2：响应式适配

  - 测试移动端显示效果
  - 使用 lg: 前缀适配大屏幕
  - 图谱画布在小屏幕自动缩放

  任务 8.3：加载状态与错误处理

  - 添加骨架屏（Skeleton）
  - 异常数据不存在时显示友好提示
  - 网络请求失败时显示重试按钮

  验收标准:
  - 所有页面在1920x1080和1366x768正常显示
  - 移动端（375x667）布局不错位
  - 加载状态动画流畅

  ---
  📅 开发时间表
  ┌──────┬────────────────┬──────────┬──────────┐
  │ 阶段 │      任务      │ 预计时间 │  负责人  │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 一   │ 类型定义扩展   │ 1天      │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 二   │ Mock数据准备   │ 0.5天    │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 三   │ Dashboard增强  │ 1.5天    │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 四   │ 格物图谱页面   │ 2天      │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 五   │ 天筹页面调整   │ 1天      │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 六   │ 浑天页面增强   │ 1.5天    │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 七   │ 数据传递与测试 │ 1天      │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 八   │ 样式优化       │ 0.5天    │ 前端开发 │
  ├──────┼────────────────┼──────────┼──────────┤
  │ 总计 │                │ 9天      │          │
  └──────┴────────────────┴──────────┴──────────┘
  ---
  🎨 技术依赖清单

  需新增依赖

  {
    "d3": "^7.8.0",
    "framer-motion": "^11.0.0",
    "@types/d3": "^7.4.0"
  }

  已有依赖（无需新增）

  - react: ^19.2.3
  - react-router-dom: 6.22.3
  - recharts: ^2.13.0
  - lucide-react: ^0.469.0
  - tailwindcss: 已配置

  ---
  ⚠️ 风险评估与缓解措施

  技术风险

  1. D3.js学习曲线
    - 缓解：参考官方示例，先实现基础力导向图
    - 备选方案：使用 react-force-graph 等封装库
  2. 动画性能问题
    - 缓解：使用CSS Transform而非重绘属性
    - 优化：限制同时播放的动画数量
  3. Mock数据管理复杂
    - 缓解：集中管理在 mockData.ts
    - 规范：统一数据格式，便于后期对接真实API

  业务风险

  1. 需求理解偏差
    - 缓解：每个阶段完成后进行演示确认
    - 建议：优先开发核心流程（Dashboard → 格物 → 天筹 → 浑天）
  2. 时间延期风险
    - 缓解：按优先级开发，核心功能优先
    - 降级方案：格物图谱可先用静态SVG替代D3.js

  ---
  ✅ 验收标准总览

  功能验收

  - 产线选择器正常工作，支持9条产线切换
  - Dashboard数据看板显示6个指标
  - 异常列表根据产线类型动态切换（SMT/PCB/3C各6个异常）
  - 格物图谱正常渲染，支持节点交互
  - 天筹页面接收异常数据并显示4个决策指标
  - 浑天页面播放设备重排或线路优化动画
  - 完整流程：Dashboard → 格物 → 天筹 → 浑天 数据传递正常

  性能验收

  - 页面加载时间 < 2秒
  - D3图谱渲染时间 < 1.5秒（50个节点以内）
  - 动画帧率 > 30fps

  兼容性验收

  - Chrome 90+, Edge 90+, Firefox 88+ 正常显示
  - 支持 1920x1080 和 1366x768 分辨率
  - 移动端布局不错位（可降低优先级）

  ---
  📝 开发规范

  代码风格

  - 使用 Biome 进行代码格式化：npm run lint
  - 组件命名：PascalCase（例如：ProductionLineSelector.tsx）
  - 函数命名：camelCase（例如：handleAnomalyClick）

  文件组织

  frontend/
  ├── components/          # 通用组件
  │   ├── ProductionLineSelector.tsx  # 新增
  │   ├── DataDashboard.tsx           # 新增
  │   ├── AnomalyList.tsx             # 新增
  │   ├── KnowledgeGraphCanvas.tsx    # 新增
  │   └── NodeDetailPanel.tsx         # 新增
  ├── pages/
  │   ├── Dashboard.tsx               # 修改
  │   ├── KnowledgeGraph.tsx          # 新增
  │   ├── Tianchou.tsx                # 修改
  │   └── Huntian.tsx                 # 修改
  ├── types.ts                        # 扩展
  ├── mockData.ts                     # 新增
  └── App.tsx                         # 添加路由

  Git提交规范

  - feat: 新增功能
  - fix: 修复bug
  - refactor: 重构代码
  - style: 样式调整
  - docs: 文档更新

  ---
  🚀 后续扩展建议

  短期优化（1-2周）

  1. 添加格物图谱导出功能（导出为PNG/SVG）
  2. 天筹页面支持多方案对比（A/B方案并排显示）
  3. 浑天仿真支持手动注入故障测试

  长期规划（1-2月）

  1. 对接真实后端API，替换Mock数据
  2. 增加用户权限管理（不同角色看到不同数据）
  3. 支持自定义知识图谱节点（用户手动添加原因/方案）
  4. 浑天仿真支持导出仿真报告（PDF）

  ---
  文档版本: v1.0
  创建日期: 2026-01-27
  最后更新: 2026-01-27
  状态: 待审核